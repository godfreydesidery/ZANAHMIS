"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[7908],{7908:(w,P,o)=>{o.r(P),o.d(P,{PatientPharmacyComponent:()=>q});var p=o(5861),_=o(9862),y=o(8237),d=o(4716),Z=o(553),g=o(6814),u=o(95),A=o(4512),M=o(4185),t=o(6689),E=o(6466),f=o(1581),T=o(585),v=o(379);function x(r,c){if(1&r){const i=t.EpF();t.TgZ(0,"input",21),t.NdJ("ngModelChange",function(e){t.CHM(i);const s=t.oxw().$implicit;return t.KtG(s.checked=e)})("ngModelChange",function(){t.CHM(i);const e=t.oxw().$implicit,s=t.oxw();return t.KtG(s.clearIssued(e.id))}),t.qZA()}if(2&r){const i=t.oxw().$implicit;t.Q6J("ngModel",i.checked)}}function C(r,c){1&r&&(t.TgZ(0,"div",22)(1,"span"),t._uU(2,"COVERED"),t.qZA()())}function U(r,c){if(1&r&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&r){const i=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.Dn7(2,1,i.patientBill.amount,"","")," ")}}function I(r,c){if(1&r){const i=t.EpF();t.TgZ(0,"input",28),t.NdJ("ngModelChange",function(e){t.CHM(i);const s=t.oxw(2).$implicit;return t.KtG(s.issued=e)}),t.qZA()}if(2&r){const i=t.oxw(2).$implicit;t.Q6J("ngModel",i.issued)}}function O(r,c){if(1&r){const i=t.EpF();t.TgZ(0,"input",29),t.NdJ("ngModelChange",function(e){t.CHM(i);const s=t.oxw(2).$implicit;return t.KtG(s.issued=e)}),t.qZA()}if(2&r){const i=t.oxw(2).$implicit;t.Q6J("ngModel",i.issued)}}function B(r,c){if(1&r){const i=t.EpF();t.TgZ(0,"div",4)(1,"div",24)(2,"button",25),t.NdJ("click",function(){t.CHM(i);const e=t.oxw().$implicit,s=t.oxw();return t.KtG(s.clearIssued(e.id))}),t._uU(3,"Set 0"),t.qZA()(),t.TgZ(4,"div",24),t.YNc(5,I,1,1,"input",26),t.YNc(6,O,1,1,"input",27),t.qZA(),t._UZ(7,"div",24),t.qZA()}if(2&r){const i=t.oxw().$implicit;t.xp6(5),t.Q6J("ngIf",!0===i.checked),t.xp6(1),t.Q6J("ngIf",!1===i.checked)}}function D(r,c){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t.YNc(2,x,1,1,"input",17),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td")(20,"div",4),t.YNc(21,C,3,0,"div",18),t.YNc(22,U,3,5,"div",19),t.qZA()(),t.TgZ(23,"td"),t.YNc(24,B,8,2,"div",20),t.qZA(),t.TgZ(25,"td"),t._uU(26),t.qZA()()),2&r){const i=c.$implicit;t.xp6(2),t.Q6J("ngIf","PENDING"===i.status||"NOT-GIVEN"===i.status),t.xp6(2),t.Oqu(i.ordered),t.xp6(2),t.Oqu(i.medicine.name),t.xp6(2),t.Oqu(i.stock),t.xp6(2),t.Oqu(i.dosage),t.xp6(2),t.Oqu(i.frequency),t.xp6(2),t.Oqu(i.route),t.xp6(2),t.Oqu(i.days),t.xp6(2),t.Oqu(i.qty),t.xp6(3),t.Q6J("ngIf","COVERED"===i.patientBill.status),t.xp6(1),t.Q6J("ngIf","PAID"===i.patientBill.status||"VERIFIED"===i.patientBill.status),t.xp6(2),t.Q6J("ngIf","PENDING"===i.status||"NOT-GIVEN"===i.status),t.xp6(2),t.Oqu(i.status)}}const h=Z.N.apiUrl;let q=(()=>{var r;class c{constructor(n,e,s,a,l,m){this.auth=n,this.http=e,this.modalService=s,this.spinner=a,this.router=l,this.msgBox=m,this.prescriptions=[],this.pharmacyName=localStorage.getItem("selected-pharmacy-name"),this.pharmacyId=localStorage.getItem("selected-pharmacy-id"),this.filterRecords=""}ngOnInit(){var n=this;return(0,p.Z)(function*(){n.id=localStorage.getItem("pharmacy-patient-id"),localStorage.removeItem("pharmacy-patient-id"),yield n.loadPatient(n.id),yield n.loadPrescriptionsByPatientAndPharmacy(n.id,n.pharmacyId)})()}loadPatient(n){var e=this;return(0,p.Z)(function*(){let s={headers:(new _.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.get(h+"/patients/get?id="+n,s).pipe((0,d.x)(()=>e.spinner.hide())).toPromise().then(a=>{e.id=a?.id,e.patient=a,console.log(a)}).catch(a=>{e.msgBox.showErrorMessage(a,"Could not load patient"),console.log(a)})})()}loadPrescriptionsByPatientAndPharmacy(n,e){var s=this;return(0,p.Z)(function*(){let a={headers:(new _.WM).set("Authorization","Bearer "+s.auth.user.access_token)};s.spinner.show(),yield s.http.get(h+"/patients/get_prescriptions_by_patient_id?patient_id="+n+"&pharmacy_id="+e,a).pipe((0,d.x)(()=>s.spinner.hide())).toPromise().then(l=>{console.log(l),s.prescriptions=l,s.prescriptions.forEach(m=>{m.checked=!1}),console.log(s.prescriptions)}).catch(l=>{s.prescriptions=[],s.msgBox.showErrorMessage(l,"")})})()}acceptPrescription(n){var e=this;return(0,p.Z)(function*(){let s={headers:(new _.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.post(h+"/patients/accept_prescription",n,s).pipe((0,d.x)(()=>e.spinner.hide())).toPromise().then(a=>{e.msgBox.showSuccessMessage("Status changed : ACCEPTED")}).catch(a=>{e.msgBox.showErrorMessage(a,"")}),e.loadPrescriptionsByPatientAndPharmacy(e.id,e.pharmacyId)})()}rejectPrescription(n){var e=this;return(0,p.Z)(function*(){let s={headers:(new _.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.post(h+"/patients/reject_prescription",n,s).pipe((0,d.x)(()=>e.spinner.hide())).toPromise().then(a=>{e.msgBox.showSuccessMessage("Status changed : REJECTED")}).catch(a=>{e.msgBox.showErrorMessage(a,"")}),e.loadPrescriptionsByPatientAndPharmacy(e.id,e.pharmacyId)})()}holdPrescription(n){var e=this;return(0,p.Z)(function*(){let s={headers:(new _.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.post(h+"/patients/hold_prescription",n,s).pipe((0,d.x)(()=>e.spinner.hide())).toPromise().then(a=>{e.msgBox.showSuccessMessage("Status changed : PENDING")}).catch(a=>{e.msgBox.showErrorMessage(a,"")}),e.loadPrescriptionsByPatientAndPharmacy(e.id,e.pharmacyId)})()}collectPrescription(n){var e=this;return(0,p.Z)(function*(){let s={headers:(new _.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.post(h+"/patients/collect_prescription",n,s).pipe((0,d.x)(()=>e.spinner.hide())).toPromise().then(a=>{e.msgBox.showSuccessMessage("Status changed : COLLECTED")}).catch(a=>{e.msgBox.showErrorMessage(a,"")}),e.loadPrescriptionsByPatientAndPharmacy(e.id,e.pharmacyId)})()}verifyPrescription(n){var e=this;return(0,p.Z)(function*(){let s={headers:(new _.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.post(h+"/patients/verify_prescription",n,s).pipe((0,d.x)(()=>e.spinner.hide())).toPromise().then(a=>{e.msgBox.showSuccessMessage("Status changed : VERIFIED, Saved successifully")}).catch(a=>{e.msgBox.showErrorMessage(a,"")}),e.loadPrescriptionsByPatientAndPharmacy(e.id,e.pharmacyId)})()}issueMedicine(){var n=this;return(0,p.Z)(function*(){let e={headers:(new _.WM).set("Authorization","Bearer "+n.auth.user.access_token)};var s=[];n.prescriptions.forEach(a=>{if(!0===a.checked){if(a.issued<=0)return void n.msgBox.showErrorMessage3("Invalid value at "+a.medicine.name);s.push(a)}}),n.spinner.show(),yield n.http.post(h+"/patients/issue_medicine?pharmacy_id="+n.pharmacyId,s,e).pipe((0,d.x)(()=>n.spinner.hide())).toPromise().then(a=>{n.msgBox.showSuccessMessage("Medicine issued successifully")}).catch(a=>{n.msgBox.showErrorMessage(a,"")}),n.loadPrescriptionsByPatientAndPharmacy(n.id,n.pharmacyId)})()}clearIssued(n){this.prescriptions.forEach(e=>{e.id===n&&(e.issued=0)})}grant(n){var e=!1;return n.forEach(s=>{this.auth.checkPrivilege(s)&&(e=!0)}),e}}return(r=c).\u0275fac=function(n){return new(n||r)(t.Y36(E.e),t.Y36(_.eN),t.Y36(f.FF),t.Y36(T.t2),t.Y36(y.F0),t.Y36(v.l))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-patient-pharmacy"]],standalone:!0,features:[t.jDz],decls:73,vars:17,consts:[[1,"content-header"],[1,"header-title"],[1,"text-primary"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["routerLink","/pharmacy-outpatient-list",1,"btn","btn-primary","btn-outline",2,"margin-right","1mm"],["routerLink","/pharmacy-inpatient-list",1,"btn","btn-primary","btn-outline",2,"margin-right","1mm"],["routerLink","/pharmacy-outsider-list",1,"btn","btn-primary","btn-outline",2,"margin-right","1mm"],[1,"panel-body"],["role","alert",1,"col-sm-12","alert","alert-primary"],[1,"table","table-responsive","table","striped","table-bordered"],[2,"font-weight","bold"],[4,"ngFor","ngForOf"],[1,"btn","btn-success","pull-right",3,"click"],["type","checkbox",3,"ngModel","ngModelChange",4,"ngIf"],["class","col-sm-12","style","text-align: center;",4,"ngIf"],["class","col-sm-12","style","text-align: right;",4,"ngIf"],["class","row",4,"ngIf"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"col-sm-12",2,"text-align","center"],[1,"col-sm-12",2,"text-align","right"],[1,"col-sm-4"],[1,"btn","btn-warning",3,"click"],["type","text","class","form-control",3,"ngModel","ngModelChange",4,"ngIf"],["type","text","class","form-control","readonly","",3,"ngModel","ngModelChange",4,"ngIf"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],["type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"]],template:function(n,e){1&n&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Pharmacy - Prescriptions ("),t.TgZ(4,"span",2),t._uU(5),t.qZA(),t._uU(6,")"),t.qZA()()(),t.TgZ(7,"section",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"a",8),t._uU(13,"Outpatient List"),t.qZA(),t.TgZ(14,"a",9),t._uU(15,"Inpatient List"),t.qZA(),t.TgZ(16,"a",10),t._uU(17,"Outsider List"),t.qZA()(),t.TgZ(18,"div",11)(19,"div",4)(20,"div",12)(21,"h4"),t._uU(22,"Name: "),t.TgZ(23,"b"),t._uU(24),t.qZA(),t._uU(25,", File No: "),t.TgZ(26,"b"),t._uU(27),t.qZA(),t._uU(28,", Date of birth: "),t.TgZ(29,"b"),t._uU(30),t.ALo(31,"date"),t.qZA(),t._uU(32,", Age: "),t.TgZ(33,"b"),t._uU(34),t.ALo(35,"age"),t.qZA(),t._uU(36),t.qZA()(),t._UZ(37,"hr"),t.qZA(),t.TgZ(38,"div",4)(39,"div",5)(40,"table",13)(41,"thead")(42,"tr",14)(43,"td"),t._uU(44,"Select"),t.qZA(),t.TgZ(45,"td"),t._uU(46,"Date | By"),t.qZA(),t.TgZ(47,"td"),t._uU(48,"Drug Name"),t.qZA(),t.TgZ(49,"td"),t._uU(50,"Stock"),t.qZA(),t.TgZ(51,"td"),t._uU(52,"Dosage"),t.qZA(),t.TgZ(53,"td"),t._uU(54,"Frequency"),t.qZA(),t.TgZ(55,"td"),t._uU(56,"Route"),t.qZA(),t.TgZ(57,"td"),t._uU(58,"Days"),t.qZA(),t.TgZ(59,"td"),t._uU(60,"Quantity"),t.qZA(),t.TgZ(61,"td"),t._uU(62,"Amount/Inst"),t.qZA(),t.TgZ(63,"td"),t._uU(64,"Giving Qty"),t.qZA(),t.TgZ(65,"td"),t._uU(66,"Status"),t.qZA()()(),t.TgZ(67,"tbody"),t.YNc(68,D,27,13,"tr",15),t.ALo(69,"searchFilter"),t.qZA()()(),t.TgZ(70,"div",5)(71,"button",16),t.NdJ("click",function(){return e.issueMedicine()}),t._uU(72,"Submit Drug Done"),t.qZA()()()()()()()()),2&n&&(t.xp6(5),t.Oqu(e.pharmacyName),t.xp6(19),t.lnq("",e.patient.firstName," ",e.patient.middleName," ",e.patient.lastName,""),t.xp6(3),t.Oqu(e.patient.no),t.xp6(3),t.Oqu(t.lcZ(31,10,e.patient.dateOfBirth)),t.xp6(4),t.Oqu(t.lcZ(35,12,e.patient.dateOfBirth)),t.xp6(2),t.AsE(", ",e.patient.gender,", ",e.patient.paymentType,""),t.xp6(32),t.Q6J("ngForOf",t.xi3(69,14,e.prescriptions,e.filterRecords)))},dependencies:[g.ez,g.sg,g.O5,g.H9,g.uU,u.u5,u.Fj,u.Wl,u.JJ,u.On,u.UX,M.G,A.C,y.rH]}),c})()}}]);