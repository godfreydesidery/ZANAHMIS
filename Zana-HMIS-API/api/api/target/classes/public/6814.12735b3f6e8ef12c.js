"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[6814],{2150:(I,g,i)=>{i.r(g),i.d(g,{StoreToPharmacyRNComponent:()=>D});var u=i(5861),m=i(9862),h=i(4716),T=i(553),Z=i(6814),_=i(95),t=i(6689),y=i(6466),A=i(1581),U=i(585),v=i(8237),N=i(379);function q(r,l){if(1&r){const e=t.EpF();t.TgZ(0,"div",4),t._UZ(1,"div",29),t.TgZ(2,"div",29)(3,"h4",2),t._uU(4,"Enter Store Requisition Order#"),t.qZA(),t.TgZ(5,"input",30),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.pharmacyToStoreRONo=n)}),t.qZA(),t._UZ(6,"br"),t.TgZ(7,"button",31),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.createGRN(null,n.pharmacyToStoreRONo))}),t._uU(8,"Create / Go to GRN"),t.qZA()(),t._UZ(9,"div",29),t.qZA()}if(2&r){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.pharmacyToStoreRONo)}}function b(r,l){if(1&r){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"small"),t._uU(3),t.qZA()(),t.TgZ(4,"td")(5,"small"),t._uU(6),t.qZA()(),t.TgZ(7,"td")(8,"small"),t._uU(9),t.ALo(10,"date"),t.qZA()(),t.TgZ(11,"td")(12,"input",38),t.NdJ("ngModelChange",function(n){const c=t.CHM(e).$implicit;return t.KtG(c.checked=n)}),t.qZA()()()}if(2&r){const e=l.$implicit;t.xp6(3),t.Oqu(null==e?null:e.no),t.xp6(3),t.Oqu(null==e?null:e.pharmacySKUQty),t.xp6(3),t.Oqu(t.lcZ(10,4,null==e?null:e.expiryDate)),t.xp6(3),t.Q6J("ngModel",e.checked)}}function R(r,l){if(1&r&&(t.TgZ(0,"table",37)(1,"thead")(2,"tr")(3,"td")(4,"small"),t._uU(5,"Batch#"),t.qZA()(),t.TgZ(6,"td")(7,"small"),t._uU(8,"Qty"),t.qZA()(),t.TgZ(9,"td")(10,"small"),t._uU(11,"Expiry Date"),t.qZA()(),t.TgZ(12,"td")(13,"small"),t._uU(14,"Check"),t.qZA()()()(),t.TgZ(15,"tbody"),t.YNc(16,b,13,6,"tr",24),t.qZA()()),2&r){const e=t.oxw().$implicit;t.xp6(16),t.Q6J("ngForOf",null==e?null:e.storeToPharmacyBatches)}}function P(r,l){if(1&r&&(t.TgZ(0,"table",37)(1,"tbody")(2,"tr")(3,"td")(4,"i")(5,"small"),t._uU(6),t.qZA()()()(),t.TgZ(7,"tr")(8,"td")(9,"small"),t._uU(10),t.qZA()()(),t.TgZ(11,"tr")(12,"td")(13,"b"),t._uU(14),t.qZA()()()()()),2&r){const e=t.oxw().$implicit;t.xp6(6),t.Oqu(null==e||null==e.item?null:e.item.code),t.xp6(4),t.Oqu(null==e||null==e.item?null:e.item.name),t.xp6(4),t.Oqu(null==e?null:e.receivedStoreSKUQty)}}function f(r,l){if(1&r&&(t.TgZ(0,"tr")(1,"td")(2,"small"),t._uU(3),t.qZA()(),t.TgZ(4,"td")(5,"small"),t._uU(6),t.qZA()(),t.TgZ(7,"td")(8,"small"),t._uU(9),t.ALo(10,"date"),t.qZA()()()),2&r){const e=l.$implicit;t.xp6(3),t.Oqu(null==e?null:e.no),t.xp6(3),t.Oqu(null==e?null:e.storeSKUQty),t.xp6(3),t.Oqu(t.lcZ(10,3,null==e?null:e.expiryDate))}}function x(r,l){if(1&r&&(t.TgZ(0,"table",37)(1,"thead")(2,"tr")(3,"td")(4,"small"),t._uU(5,"Batch#"),t.qZA()(),t.TgZ(6,"td")(7,"small"),t._uU(8,"Qty"),t.qZA()(),t.TgZ(9,"td")(10,"small"),t._uU(11,"Expiry Date"),t.qZA()()()(),t.TgZ(12,"tbody"),t.YNc(13,f,11,5,"tr",24),t.qZA()()),2&r){const e=t.oxw().$implicit;t.xp6(13),t.Q6J("ngForOf",null==e?null:e.storeToPharmacyBatches)}}function O(r,l){if(1&r&&(t.TgZ(0,"tr")(1,"td")(2,"table",35)(3,"tbody")(4,"tr")(5,"td")(6,"b"),t._uU(7,"Code"),t.qZA()(),t.TgZ(8,"td")(9,"i")(10,"small"),t._uU(11),t.qZA()()()(),t.TgZ(12,"tr")(13,"td")(14,"b"),t._uU(15,"Name"),t.qZA()(),t.TgZ(16,"td")(17,"small"),t._uU(18),t.qZA()()(),t.TgZ(19,"tr")(20,"td")(21,"b"),t._uU(22,"Qty/Uom"),t.qZA()(),t.TgZ(23,"td")(24,"b"),t._uU(25),t.qZA()()()()()(),t.TgZ(26,"td")(27,"table",35)(28,"tbody")(29,"tr")(30,"td")(31,"i")(32,"small"),t._uU(33),t.qZA()()()(),t.TgZ(34,"tr")(35,"td")(36,"small"),t._uU(37),t.qZA()()(),t.TgZ(38,"tr")(39,"td")(40,"b"),t._uU(41),t.qZA()()()()(),t.YNc(42,R,17,1,"table",36),t.qZA(),t.TgZ(43,"td"),t.YNc(44,P,15,3,"table",36),t.YNc(45,x,14,1,"table",36),t.qZA()()),2&r){const e=l.$implicit;t.xp6(11),t.Oqu(null==e||null==e.medicine?null:e.medicine.code),t.xp6(7),t.Oqu(null==e||null==e.medicine?null:e.medicine.name),t.xp6(7),t.Oqu(null==e?null:e.orderedPharmacySKUQty),t.xp6(8),t.Oqu(null==e||null==e.medicine?null:e.medicine.code),t.xp6(4),t.Oqu(null==e||null==e.medicine?null:e.medicine.name),t.xp6(4),t.Oqu(null==e?null:e.receivedPharmacySKUQty),t.xp6(1),t.Q6J("ngIf",e.storeToPharmacyBatches.length>0),t.xp6(2),t.Q6J("ngIf",e.storeToPharmacyBatches.length>0),t.xp6(1),t.Q6J("ngIf",e.storeToPharmacyBatches.length>0)}}function C(r,l){if(1&r){const e=t.EpF();t.TgZ(0,"div",4),t._UZ(1,"hr"),t.TgZ(2,"div",5)(3,"h5"),t._uU(4),t.qZA(),t.TgZ(5,"h5"),t._uU(6),t.ALo(7,"date"),t.qZA(),t.TgZ(8,"h5"),t._uU(9),t.qZA(),t.TgZ(10,"h5"),t._uU(11),t.qZA(),t.TgZ(12,"h5"),t._uU(13),t.qZA(),t.TgZ(14,"h5"),t._uU(15),t.qZA()(),t.TgZ(16,"div",5)(17,"div",4),t._UZ(18,"div",29)(19,"div",29),t.TgZ(20,"div",29)(21,"input",32),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.filterRecords=n)}),t.qZA()()(),t._UZ(22,"br"),t.TgZ(23,"table",33)(24,"thead")(25,"tr",34)(26,"td"),t._uU(27,"Ordered from Pharmacy - Pharmacy SKUs"),t.qZA(),t.TgZ(28,"td"),t._uU(29,"Received from Store - Pharmacy SKUs"),t.qZA(),t.TgZ(30,"td"),t._uU(31,"Issued from Store - Store SKUs"),t.qZA()()(),t.TgZ(32,"tbody"),t.YNc(33,O,46,9,"tr",24),t.qZA()()(),t.TgZ(34,"div",5)(35,"button",31),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.approveReceipt())}),t._uU(36,"Appprove Receipt"),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(4),t.hij("GRN No: ",null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.no,""),t.xp6(2),t.hij("GRN Date: ",t.lcZ(7,8,null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.receivingDate),""),t.xp6(3),t.hij("Created: ",null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.created,""),t.xp6(2),t.hij("Verified: ",null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.verified,""),t.xp6(2),t.hij("Approved: ",null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.approved,""),t.xp6(2),t.hij("Status: ",null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.status,""),t.xp6(6),t.Q6J("ngModel",e.filterRecords),t.xp6(12),t.Q6J("ngForOf",null==e.storeToPharmacyRN?null:e.storeToPharmacyRN.storeToPharmacyRNDetails)}}function S(r,l){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"date"),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td")(12,"span",39),t._uU(13,"[Select]"),t.qZA()()()),2&r){const e=l.$implicit;t.xp6(2),t.Oqu(e.no),t.xp6(2),t.Oqu(t.lcZ(5,4,e.orderDate)),t.xp6(3),t.Oqu(t.lcZ(8,6,e.validUntil)),t.xp6(3),t.Oqu(e.status)}}function M(r,l){if(1&r){const e=t.EpF();t.TgZ(0,"button",41),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw();return t.KtG(a.createGRN(null==n?null:n.id,""))}),t._uU(1,"Create / Go to GRN"),t.qZA()}}function E(r,l){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t._UZ(5,"br"),t._uU(6),t._UZ(7,"br"),t._uU(8," Receiving Note: "),t.qZA(),t.TgZ(9,"td"),t.YNc(10,M,2,0,"button",40),t.qZA()()),2&r){const e=l.$implicit;t.xp6(2),t.Oqu(null==e?null:e.no),t.xp6(2),t.hij(" Requisition Order: ",null==e?null:e.status,""),t.xp6(2),t.hij(" Transfer Order: ",null==e||null==e.storeToPharmacyTO?null:e.storeToPharmacyTO.status,""),t.xp6(4),t.Q6J("ngIf","GOODS-ISSUED"===(null==e?null:e.status))}}const p=T.N.apiUrl;let D=(()=>{var r;class l{constructor(o,n,a,c,s,d){this.auth=o,this.http=n,this.modalService=a,this.spinner=c,this.router=s,this.msgBox=d,this.pharmacyId=localStorage.getItem("selected-pharmacy-id"),this.pharmacyName=localStorage.getItem("selected-pharmacy-name"),this.pharmacyToStoreRONo="",this.no="",this.status="",this.created="",this.verified="",this.approved="",this.roId=null,this.noLocked=!1,this.pharmacyToStoreROs=[],this.detailCode="",this.detailName="",this.detailOrderedQty=0,this.detailReceivedQty=0,this.medicineNames=[],this.filterRecords=""}ngOnInit(){var o=this;return(0,u.Z)(function*(){o.loadOrdersByPharmacy()})()}createGRN(o,n){var a=this;return(0,u.Z)(function*(){let c={headers:(new m.WM).set("Authorization","Bearer "+a.auth.user.access_token)};var s={id:o,no:n,pharmacy:{id:a.pharmacyId}};a.spinner.show(),yield a.http.post(p+"/store_to_pharmacy_r_ns/create",s,c).pipe((0,h.x)(()=>a.spinner.hide())).toPromise().then(d=>{a.storeToPharmacyRN=d,console.log(d)}).catch(d=>{console.log(d),a.msgBox.showErrorMessage(d,"")})})()}loadOrdersByPharmacy(){var o=this;return(0,u.Z)(function*(){let n={headers:(new m.WM).set("Authorization","Bearer "+o.auth.user.access_token)};o.spinner.show(),yield o.http.get(p+"/pharmacy_to_store_r_os/load_pharmacy_orders_by_pharmacy?pharmacy_id="+o.pharmacyId,n).pipe((0,h.x)(()=>o.spinner.hide())).toPromise().then(a=>{o.pharmacyToStoreROs=a,console.log(a)},a=>{console.log(a),o.msgBox.showErrorMessage(a,"")})})()}searchMedicine(){var o=this;return(0,u.Z)(function*(){let n={headers:(new m.WM).set("Authorization","Bearer "+o.auth.user.access_token)};""!=o.detailCode?(o.spinner.show(),yield o.http.get(p+"/medicines/get_by_code?code="+o.detailCode,n).pipe((0,h.x)(()=>o.spinner.hide())).toPromise().then(a=>{o.clearDetail(),o.detailCode=a.code,o.detailName=a.name},a=>{console.log(a),o.msgBox.showErrorMessage(a,"")})):(o.spinner.show(),yield o.http.get(p+"/medicines/get_by_name?name="+o.detailName,n).pipe((0,h.x)(()=>o.spinner.hide())).toPromise().then(a=>{o.clearDetail(),o.detailCode=a.code,o.detailName=a.name},a=>{console.log(a),o.msgBox.showErrorMessage(a,"")}))})()}clear(){this.pharmacyToStoreRONo="",this.storeToPharmacyRN.id=null,this.storeToPharmacyRN.no=""}clearDetail(){this.detailId=null,this.detailCode="",this.detailName="",this.detailOrderedQty=0,this.detailReceivedQty=0}approveReceipt(){var o=this;return(0,u.Z)(function*(){var n=1;if(o.storeToPharmacyRN.storeToPharmacyRNDetails.forEach(s=>{s.storeToPharmacyBatches.forEach(d=>{if(void 0===d.checked||!1===d.checked)return o.msgBox.showErrorMessage3("Can not approve receipt. You can not receive less than the supplied goods"),void(n=0)})}),0===n||!window.confirm("Confirm receive goods. Confirm?"))return;let a={headers:(new m.WM).set("Authorization","Bearer "+o.auth.user.access_token)};var c=o.storeToPharmacyRN;o.spinner.show(),yield o.http.post(p+"/store_to_pharmacy_r_ns/approve_receipt",c,a).pipe((0,h.x)(()=>o.spinner.hide())).toPromise().then(s=>{o.msgBox.showSuccessMessage("Goods received successifuly"),console.log(s)},s=>{console.log(s),o.msgBox.showErrorMessage(s,"")})})()}grant(o){var n=!1;return o.forEach(a=>{this.auth.checkPrivilege(a)&&(n=!0)}),n}}return(r=l).\u0275fac=function(o){return new(o||r)(t.Y36(y.e),t.Y36(m.eN),t.Y36(A.FF),t.Y36(U.t2),t.Y36(v.F0),t.Y36(N.l))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-store-to-pharmacy-r-n"]],standalone:!0,features:[t.jDz],decls:119,vars:5,consts:[[1,"content-header"],[1,"header-title"],[1,"text-primary"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["data-toggle","modal","data-target","#requisition-order-list-modal",1,"btn","btn-primary","btn-outline"],["data-toggle","modal","data-target","#store-receiving-note-list-modal",1,"btn","btn-primary","btn-outline"],[1,"btn","btn-primary","btn-outline",3,"click"],[1,"panel-body"],["class","row",4,"ngIf"],["id","order-list-modal","tabindex","-1","role","dialog",1,"modal","fade","modal-success"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-title"],[1,"modal-body"],[1,"table","table-bordered"],[2,"position","sticky","top","0"],[1,"table-dark"],[4,"ngFor","ngForOf"],["id","requisition-order-list-modal","tabindex","-1","role","dialog",1,"modal","fade","modal-success"],[1,"table","table-responsive","table-bordered"],["id","store-receiving-note-list-modal","tabindex","-1","role","dialog",1,"modal","fade","modal-success"],[1,"table","table-responsive","table-striped","table-bordered"],[1,"col-sm-4"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","pull-right",3,"click"],["type","text","placeholder","Search...",1,"form-control","pull-right",2,"max-width","8cm",3,"ngModel","ngModelChange"],[1,"table","table-responsive","table-striped","table-bordered","table-small"],[2,"font-weight","bold"],[1,"table"],["class","table table-responsive",4,"ngIf"],[1,"table","table-responsive"],["type","checkbox",3,"ngModel","ngModelChange"],["data-dismiss","modal",2,"cursor","pointer"],["class","btn btn-primary","data-dismiss","modal","aria-label","Close",3,"click",4,"ngIf"],["data-dismiss","modal","aria-label","Close",1,"btn","btn-primary",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Store GRN("),t.TgZ(4,"span",2),t._uU(5),t.qZA(),t._uU(6,")"),t.qZA()()(),t.TgZ(7,"section",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"button",8),t._uU(13,"Requisition Order List"),t.qZA(),t.TgZ(14,"button",9),t._uU(15,"Store GRN List"),t.qZA(),t.TgZ(16,"button",10),t.NdJ("click",function(){return n.clear()}),t._uU(17,"New Store GRN"),t.qZA()(),t.TgZ(18,"div",11),t.YNc(19,q,10,1,"div",12),t.YNc(20,C,37,10,"div",12),t.qZA()()()()(),t.TgZ(21,"div",13)(22,"div",14)(23,"div",15)(24,"div",16)(25,"button",17)(26,"span",18),t._uU(27,"\xd7"),t.qZA()(),t.TgZ(28,"h3",19),t._uU(29,"Order List"),t.qZA()(),t.TgZ(30,"div",20)(31,"table",21)(32,"thead",22)(33,"tr",23)(34,"td"),t._uU(35,"Order#"),t.qZA(),t.TgZ(36,"td"),t._uU(37,"Order Date"),t.qZA(),t.TgZ(38,"td"),t._uU(39,"Valid Until"),t.qZA(),t.TgZ(40,"td"),t._uU(41,"Status"),t.qZA(),t.TgZ(42,"td"),t._uU(43,"Select"),t.qZA()()(),t.TgZ(44,"tbody"),t.YNc(45,S,14,8,"tr",24),t.qZA()()()()()(),t.TgZ(46,"div",25)(47,"div",14)(48,"div",15)(49,"div",16)(50,"button",17)(51,"span",18),t._uU(52,"\xd7"),t.qZA()(),t.TgZ(53,"h3",19),t._uU(54,"Requisition Order List"),t.qZA()(),t.TgZ(55,"div",20)(56,"div",4)(57,"div",5)(58,"table",26)(59,"thead")(60,"tr")(61,"td"),t._uU(62,"Requisition Order#"),t.qZA(),t.TgZ(63,"td"),t._uU(64,"Order Summary"),t.qZA(),t.TgZ(65,"td"),t._uU(66,"Action"),t.qZA()()(),t.TgZ(67,"tbody"),t.YNc(68,E,11,4,"tr",24),t.qZA()()()()()()()(),t.TgZ(69,"div",27)(70,"div",14)(71,"div",15)(72,"div",16)(73,"button",17)(74,"span",18),t._uU(75,"\xd7"),t.qZA()(),t.TgZ(76,"h3",19),t._uU(77,"Store GRN List"),t.qZA()(),t.TgZ(78,"div",20)(79,"div",4)(80,"div",5)(81,"table",28)(82,"thead")(83,"tr")(84,"td"),t._uU(85,"GRN#"),t.qZA(),t.TgZ(86,"td"),t._uU(87,"Status"),t.qZA(),t.TgZ(88,"td"),t._uU(89,"Action"),t.qZA()()(),t.TgZ(90,"tbody")(91,"tr")(92,"td"),t._uU(93,"GRN-273748-484"),t.qZA(),t.TgZ(94,"td"),t._uU(95,"PENDING"),t.qZA(),t.TgZ(96,"td"),t._uU(97,"select"),t.qZA()(),t.TgZ(98,"tr")(99,"td"),t._uU(100,"GRN-273748-484"),t.qZA(),t.TgZ(101,"td"),t._uU(102,"PENDING"),t.qZA(),t.TgZ(103,"td"),t._uU(104,"select"),t.qZA()(),t.TgZ(105,"tr")(106,"td"),t._uU(107,"GRN-273748-484"),t.qZA(),t.TgZ(108,"td"),t._uU(109,"PENDING"),t.qZA(),t.TgZ(110,"td"),t._uU(111,"select"),t.qZA()(),t.TgZ(112,"tr")(113,"td"),t._uU(114,"GRN-273748-484"),t.qZA(),t.TgZ(115,"td"),t._uU(116,"PENDING"),t.qZA(),t.TgZ(117,"td"),t._uU(118,"select"),t.qZA()()()()()()()()()()),2&o&&(t.xp6(5),t.Oqu(n.pharmacyName),t.xp6(14),t.Q6J("ngIf",null===(null==n.storeToPharmacyRN?null:n.storeToPharmacyRN.id)),t.xp6(1),t.Q6J("ngIf",null!=(null==n.storeToPharmacyRN?null:n.storeToPharmacyRN.id)),t.xp6(25),t.Q6J("ngForOf",n.pharmacyToStoreROs),t.xp6(23),t.Q6J("ngForOf",n.pharmacyToStoreROs))},dependencies:[Z.ez,Z.sg,Z.O5,Z.uU,_.u5,_.Fj,_.Wl,_.JJ,_.On,_.UX]}),l})()}}]);