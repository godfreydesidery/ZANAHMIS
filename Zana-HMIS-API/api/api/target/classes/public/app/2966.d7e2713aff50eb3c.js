"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[2966],{2966:(q,C,r)=>{r.r(C),r.d(C,{DoctorToLaboratoryReportComponent:()=>z});var p=r(5861),M=r(553),D=r(775),T=r(9862),v=r(4716),b=r(7069),g=r(206),h=r(6814),d=r(95),t=r(6689),Z=r(6466),x=r(7140),P=r(585),N=r(379),O=r(2848);function R(l,c){if(1&l){const n=t.EpF();t.TgZ(0,"option",23),t.NdJ("click",function(){const i=t.CHM(n).$implicit,e=t.oxw(2);return t.KtG(e.getClinician(i.id))}),t._uU(1),t.qZA()}if(2&l){const n=c.$implicit;t.xp6(1),t.lnq("",null==n?null:n.firstName," ",null==n?null:n.middleName," ",null==n?null:n.lastName," ")}}function y(l,c){if(1&l&&(t.TgZ(0,"div",3)(1,"div",4)(2,"select",21),t.YNc(3,R,2,3,"option",22),t.qZA()()()),2&l){const n=t.oxw();t.xp6(3),t.Q6J("ngForOf",n.clinicians)}}function L(l,c){if(1&l){const n=t.EpF();t.TgZ(0,"div",3)(1,"div",24)(2,"h4"),t._uU(3,"From"),t.qZA()(),t.TgZ(4,"div",25)(5,"input",26),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.startDate=o)}),t.qZA()(),t.TgZ(6,"div",24)(7,"h4"),t._uU(8,"To"),t.qZA()(),t.TgZ(9,"div",25)(10,"input",26),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.endDate=o)}),t.qZA()(),t.TgZ(11,"div",25)(12,"button",27),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.loadLabTestReport(o.startDate,o.endDate))}),t._uU(13,"Run Report"),t.qZA()(),t.TgZ(14,"div",24)(15,"button",27),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.clear())}),t._uU(16,"Clear"),t.qZA()()()}if(2&l){const n=t.oxw();t.xp6(5),t.Q6J("ngModel",n.startDate),t.xp6(5),t.Q6J("ngModel",n.endDate)}}function U(l,c){if(1&l&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&l){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(null==n||null==n.insurancePlan?null:n.insurancePlan.name)}}function I(l,c){1&l&&(t.TgZ(0,"span"),t._uU(1,"Cash"),t.qZA())}function S(l,c){if(1&l&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t.YNc(10,U,2,1,"span",28),t.YNc(11,I,2,0,"span",28),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.ALo(14,"dateOnly"),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA()()),2&l){const n=c.$implicit;t.xp6(2),t.lnq("",null==n||null==n.patient?null:n.patient.firstName," ",null==n||null==n.patient?null:n.patient.middleName," ",null==n||null==n.patient?null:n.patient.lastName,""),t.xp6(2),t.Oqu(null==n||null==n.patient?null:n.patient.phoneNo),t.xp6(2),t.Oqu(null==n||null==n.patient?null:n.patient.no),t.xp6(2),t.Oqu(null==n||null==n.labTestType?null:n.labTestType.name),t.xp6(2),t.Q6J("ngIf","COVERED"===(null==n||null==n.patientBill?null:n.patientBill.status)),t.xp6(1),t.Q6J("ngIf","VERIFIED"===(null==n||null==n.patientBill?null:n.patientBill.status)||"PAID"===(null==n||null==n.patientBill?null:n.patientBill.status)||"UNPAID"===(null==n||null==n.patientBill?null:n.patientBill.status)),t.xp6(2),t.Oqu(t.lcZ(14,10,n.createdAt)),t.xp6(3),t.Oqu(null==n?null:n.status)}}var B=r(6236);const k=r(217),m=M.N.apiUrl;let z=(()=>{var l;class c{constructor(a,o,i,e,u,f){var _=this;this.auth=a,this.http=o,this.modalService=i,this.spinner=e,this.msgBox=u,this.data=f,this.report=[],this.filterRecords="",this.labTests=[],this.clinicianLocked=!1,this.clinicianId=null,this.clinicianCode="",this.clinicianName="",this.clinicians=[],this.print=(0,p.Z)(function*(){if(0===_.labTests.length)return void _.msgBox.showErrorMessage3("No data to export");_.documentHeader=yield _.data.getDocumentHeader();var A=[[{text:"Patient Name",fontSize:9,fillColor:"#bdc6c7"},{text:"Phone",fontSize:9,fillColor:"#bdc6c7"},{text:"Reg#",fontSize:9,fillColor:"#bdc6c7"},{text:"Lab Test",fontSize:9,fillColor:"#bdc6c7"},{text:"Mode",fontSize:9,fillColor:"#bdc6c7"},{text:"Date",fontSize:9,fillColor:"#bdc6c7"},{text:"Status",fontSize:9,fillColor:"#bdc6c7"}]];_.labTests.forEach(s=>{var E=[{text:(s?.patient?.firstName+" "+s.patient?.middleName+" "+s.patient?.lastName).toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.patient?.phoneNo.toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.patient?.no.toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.labTestType?.name.toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.patient?.paymentType.toString(),fontSize:9,fillColor:"#ffffff"},{text:(new g.c).transform(s?.createdAt).toString(),fontSize:9,fillColor:"#ffffff"},{text:s.status.toString(),fontSize:9,fillColor:"#ffffff"}];A.push(E)});const W={header:"",footer:function(s,E){return s.toString()+" of "+E},content:[{columns:[_.documentHeader]},"  ",{text:"Lab Tests Report",fontSize:14,bold:!0,alignment:"center"},_.data.getHorizontalLine()," ","Doctor: "+_.clinicianName," ",{layout:"noBorders",table:{widths:[80,80],body:[[{text:"From: "+_.startDate.toString(),fontSize:9},{text:"To: "+_.endDate.toString(),fontSize:9}]]}},"  ",{table:{headerRows:1,widths:[110,80,90,50,50,50,50],body:A}}]};b.createPdf(W).print()}),window.pdfMake.vfs=B.pdfMake.vfs}ngOnInit(){return(0,p.Z)(function*(){})()}loadLabTestReport(a,o){var i=this;return(0,p.Z)(function*(){let e={headers:(new T.WM).set("Authorization","Bearer "+i.auth.user.access_token)};if(void 0!==a&&void 0!==o)if(a>o)i.msgBox.showErrorMessage3("Could not run. Start date must be earlier or equal to end date");else{null===i.clinicianId&&i.msgBox.showErrorMessage3("Could not run. Please select Doctor");var u={from:a,to:o,clinician:{id:i.clinicianId}};i.spinner.show(),yield i.http.post(m+"/reports/doctor_to_laboratory_report",u,e).pipe((0,v.x)(()=>i.spinner.hide())).toPromise().then(f=>{i.labTests=f,console.log(i.labTests)}).catch(f=>{i.msgBox.showErrorMessage(f,"")})}else i.msgBox.showErrorMessage3("Could not run. Please select date range")})()}clear(){this.labTests=[],this.clinicianId=null,this.clinicianName="",this.clinicianCode="",this.clinicians=[],this.clinicianLocked=!1}loadCliniciansLike(a){var o=this;return(0,p.Z)(function*(){if(o.clinicians=[],a.length<2)return;let i={headers:(new T.WM).set("Authorization","Bearer "+o.auth.user.access_token)};yield o.http.get(m+"/clinicians/load_clinicians_like?name_like="+a,i).toPromise().then(e=>{console.log(e),o.clinicians=e}).catch(e=>{o.msgBox.showErrorMessage(e,"")})})()}getClinician(a){var o=this;return(0,p.Z)(function*(){let i={headers:(new T.WM).set("Authorization","Bearer "+o.auth.user.access_token)};o.clinicians=[],o.spinner.show(),yield o.http.get(m+"/clinicians/get?id="+a,i).pipe((0,v.x)(()=>o.spinner.hide())).toPromise().then(e=>{o.clinicianId=e?.id,o.clinicianCode=e.code,o.clinicianName=e.firstName+" "+e.middleName+" "+e.lastName,o.clinicianLocked=!0}).catch(e=>{o.msgBox.showErrorMessage(e,""),console.log(e)})})()}exportToSpreadsheet(){var a=this;return(0,p.Z)(function*(){let o=new D.Workbook,i=o.addWorksheet("LabTest Report");i.columns=[{header:"Patient Name",key:"PATIENT_NAME"},{header:"Patient Phone",key:"PATIENT_PHONE"},{header:"Registration#",key:"REGISTRATION_NO"},{header:"Lab Test",key:"PROCEDURE_TYPE"},{header:"Payment Mode",key:"PAYMENT_MODE"},{header:"LabTest Date",key:"CONSULTATION_DATE"},{header:"Status",key:"STATUS"}],a.spinner.show(),a.labTests.forEach(e=>{i.addRow({PATIENT_NAME:(e?.patient?.firstName+" "+e.patient?.middleName+" "+e.patient?.lastName).toString(),PATIENT_PHONE:e?.patient?.phoneNo,REGISTRATION_NO:e?.patient?.no,PROCEDURE_TYPE:e?.labTestType?.name,PAYMENT_MODE:e?.patient?.paymentType,CONSULTATION_DATE:(new g.c).transform(e?.createdAt),STATUS:e?.status},"n")}),a.spinner.hide(),o.xlsx.writeBuffer().then(e=>{let u=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});k.saveAs(u,"LabTests Report "+a.startDate.toString()+" to "+a.endDate.toString()+".xlsx")})})()}grant(a){var o=!1;return a.forEach(i=>{this.auth.checkPrivilege(i)&&(o=!0)}),o}}return(l=c).\u0275fac=function(a){return new(a||l)(t.Y36(Z.e),t.Y36(T.eN),t.Y36(x.FF),t.Y36(P.t2),t.Y36(N.l),t.Y36(O.D))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-doctor-to-laboratory-report"]],standalone:!0,features:[t.jDz],decls:49,vars:5,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["type","button",1,"btn","btn-success","btn-outline",3,"click"],[1,"fa","fa-print"],[1,"panel-body"],[1,"col-sm-3"],[1,"input-group"],["type","text","name","q","placeholder","Search Doctor...",1,"form-control",3,"ngModel","readonly","ngModelChange"],[1,"input-group-btn"],[1,"btn",3,"click"],[1,"fa","fa-times-rectangle"],["class","row",4,"ngIf"],[1,"col-sm-12",2,"height","100%","overflow","scroll"],[1,"table","table-responsive","table-hover","table-striped","table-small"],[2,"font-weight","bold"],[4,"ngFor","ngForOf"],["multiple","multiple",1,"form-control"],["style","height: 1cm; cursor: pointer; font-size: large;",3,"click",4,"ngFor","ngForOf"],[2,"height","1cm","cursor","pointer","font-size","large",3,"click"],[1,"col-sm-1"],[1,"col-sm-2"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","btn-outline",3,"click"],[4,"ngIf"]],template:function(a,o){1&a&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Doctor to Lab Report"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t.NdJ("click",function(){return o.print()}),t._UZ(10,"i",8),t._uU(11," Print"),t.qZA()(),t.TgZ(12,"div",9)(13,"div",3)(14,"div",4)(15,"div",3)(16,"div",10)(17,"h4"),t._uU(18,"Doctor Name"),t.qZA(),t.TgZ(19,"div",11)(20,"input",12),t.NdJ("ngModelChange",function(e){return o.clinicianName=e})("ngModelChange",function(e){return o.loadCliniciansLike(e)}),t.qZA(),t.TgZ(21,"span",13)(22,"button",14),t.NdJ("click",function(){return o.clear()}),t._UZ(23,"i",15),t.qZA()()(),t.YNc(24,y,4,1,"div",16),t.qZA()(),t._UZ(25,"hr"),t.YNc(26,L,17,2,"div",16),t.qZA()(),t.TgZ(27,"div",3)(28,"div",17),t._UZ(29,"hr"),t.TgZ(30,"table",18)(31,"thead")(32,"tr",19)(33,"td"),t._uU(34,"Patient Name"),t.qZA(),t.TgZ(35,"td"),t._uU(36,"Patient Phone"),t.qZA(),t.TgZ(37,"td"),t._uU(38,"Registration#"),t.qZA(),t.TgZ(39,"td"),t._uU(40,"Lab Test"),t.qZA(),t.TgZ(41,"td"),t._uU(42,"Payment Mode"),t.qZA(),t.TgZ(43,"td"),t._uU(44,"LabTest Date"),t.qZA(),t.TgZ(45,"td"),t._uU(46,"Status"),t.qZA()()(),t.TgZ(47,"tbody"),t.YNc(48,S,17,12,"tr",20),t.qZA()()()()()()()()()),2&a&&(t.xp6(20),t.Q6J("ngModel",o.clinicianName)("readonly",o.clinicianLocked),t.xp6(4),t.Q6J("ngIf",o.clinicians.length>0),t.xp6(2),t.Q6J("ngIf",null!=o.clinicianId),t.xp6(22),t.Q6J("ngForOf",o.labTests))},dependencies:[h.ez,h.sg,h.O5,d.u5,d.YN,d.Kr,d.Fj,d.JJ,d.On,d.UX,g.c]}),c})()}}]);