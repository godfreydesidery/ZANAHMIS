"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[6306],{6306:(y,g,s)=>{s.r(g),s.d(g,{RoleComponent:()=>U});var p=s(5861),m=s(6814),c=s(9862),r=s(95),h=s(8237),_=s(4716),f=s(4185),b=s(553),e=s(6689),Z=s(6466),R=s(585),v=s(379);function T(i,d){if(1&i&&(e.TgZ(0,"option",43),e._uU(1),e.qZA()),2&i){const a=d.$implicit;e.Q6J("ngValue",a),e.xp6(1),e.Oqu(a.name)}}function M(i,d){if(1&i){const a=e.EpF();e.TgZ(0,"button",44),e.NdJ("click",function(){e.CHM(a);const t=e.oxw();return e.KtG(t.getRole(t.name))}),e._uU(1,"Search"),e.qZA()}}function C(i,d){if(1&i){const a=e.EpF();e.TgZ(0,"font",47),e.NdJ("click",function(){e.CHM(a);const t=e.oxw().$implicit,o=e.oxw();return e.KtG(o.getRole(t.name))}),e._uU(1,"Select"),e.qZA()}}function E(i,d){if(1&i&&(e.TgZ(0,"tr")(1,"td",45),e._uU(2),e.qZA(),e.TgZ(3,"td",45),e._uU(4),e.qZA(),e.TgZ(5,"td",45),e.YNc(6,C,2,0,"font",46),e.qZA()()),2&i){const a=d.$implicit;e.xp6(2),e.Oqu(a.name),e.xp6(2),e.Oqu(null==a?null:a.owner),e.xp6(2),e.Q6J("ngIf","SYSTEM"!=(null==a?null:a.owner))}}const A=function(){return["ROLE-R"]},u=b.N.apiUrl;let U=(()=>{var i;class d{constructor(n,t,o,l){this.auth=n,this.http=t,this.spinner=o,this.msgBox=l,this.nameLocked=!0,this.enableSearch=!1,this.enableSave=!1,this.enableDelete=!1,this.filterRecords="",this.id=null,this.name="",this.granted=!1,this.active=!1,this.roles=[]}ngOnInit(){this.getRoles()}saveRole(){var n=this;return(0,p.Z)(function*(){if(0==n.validateInputs())return;let t={headers:(new c.WM).set("Authorization","Bearer "+n.auth.user.access_token)};null==n.id?(n.spinner.show(),yield n.http.post(u+"/roles/create",n.getRoleData(),t).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(o=>{n.nameLocked=!0,n.id=o?.id,n.name=o.name,n.enableDelete=!0,console.log(o),n.roles=[],n.getRoles(),alert("Role created successifully")}).catch(o=>{console.log(o),n.msgBox.showErrorMessage(o,"Could not create role")})):(n.spinner.show(),yield n.http.put(u+"/roles/update",n.getRoleData(),t).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(o=>{console.log(o),n.roles=[],n.getRoles(),alert("Role updated successifully")}).catch(o=>{console.log(o),n.msgBox.showErrorMessage(o,"Could not update role")}))})()}getRoles(){var n=this;return(0,p.Z)(function*(){let t={headers:(new c.WM).set("Authorization","Bearer "+n.auth.user.access_token)};n.spinner.show(),yield n.http.get(u+"/roles",t).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(o=>{o?.forEach(l=>{n.roles.push(l)})}).catch(o=>{console.log(o)})})()}getRole(n){var t=this;return(0,p.Z)(function*(){let o={headers:(new c.WM).set("Authorization","Bearer "+t.auth.user.access_token)};t.searchKey=n,t.clearFields(),t.name=t.searchKey,t.spinner.show(),yield t.http.get(u+"/roles/get_role?name="+t.searchKey,o).pipe((0,_.x)(()=>t.spinner.hide())).toPromise().then(l=>{t.nameLocked=!0,t.id=l?.id,t.name=l.name,t.enableDelete=!0}).catch(l=>{console.log(l),t.name="",t.msgBox.showErrorMessage(l,"No matching role")})})()}deleteRole(n){var t=this;return(0,p.Z)(function*(){if(!window.confirm("Confirm deletion of the selected role"))return;let o={headers:(new c.WM).set("Authorization","Bearer "+t.auth.user.access_token)};return t.spinner.show(),yield t.http.delete(u+"/roles/delete?id="+n,o).pipe((0,_.x)(()=>t.spinner.hide())).toPromise().then(l=>{t.id=null,t.name="",t.roles=[],t.nameLocked=!0,t.getRoles()}).catch(l=>(console.log(l),t.msgBox.showErrorMessage(l,"Could not delete role"),!1)),!0})()}validateInputs(){return""!=this.name||(alert("Empty name not allowed, please fill in the name field"),!1)}getRoleData(){return{id:this.id,name:this.name}}showRole(n){this.id=n.id,this.name=n.name,this.enableDelete=!0}clearFields(){this.id=null,this.name="",this.enableSave=!0,this.enableDelete=!1,this.nameLocked=!1}edit(){this.nameLocked=!1}grant(n){var t=!1;return n.forEach(o=>{this.auth.checkPrivilege(o)&&(t=!0)}),t}}return(i=d).\u0275fac=function(n){return new(n||i)(e.Y36(Z.e),e.Y36(c.eN),e.Y36(R.t2),e.Y36(v.l))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-role"]],standalone:!0,features:[e.jDz],decls:73,vars:12,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["routerLink","/home"],["data-mdb-toggle","tooltip","title","Go to Home dashboard",1,"btn","btn-primary","btn-outline"],[1,"glyphicon","glyphicon-home"],["data-mdb-toggle","tooltip","title","Create a new Role",1,"btn","btn-primary","btn-outline",3,"click"],[1,"glyphicon","glyphicon-file"],["data-mdb-toggle","tooltip","title","Edit an existing Role",1,"btn","btn-primary","btn-outline",3,"click"],[1,"glyphicon","glyphicon-pencil"],["data-mdb-toggle","tooltip","title","Delete an existing Role",1,"btn","btn-primary","btn-outline",3,"click"],[1,"glyphicon","glyphicon-trash"],["data-mdb-toggle","tooltip","title","Save or Update an existing Role",1,"btn","btn-primary","btn-outline",3,"disabled","click"],[1,"glyphicon","glyphicon-floppy-disk"],[1,"panel-body"],[1,"col-sm-6"],["type","hidden","name","id",3,"ngModel","ngModelChange"],[1,"col-sm-4"],[1,"col-sm-5"],["type","text","name","username","required","","list","role_names",1,"form-control","input-sm","special",3,"readonly","ngModel","ngModelChange"],["id","role_names",2,"padding","0px"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-sm-3"],["class","btn btn-success form-control",3,"click",4,"ngIf"],[1,"col-sm-6",2,"height","100%","overflow","scroll"],["type","text","placeholder","Search...",1,"form-control","pull-right",2,"max-width","8cm",3,"ngModel","ngModelChange"],[1,"table","table-bordered","table-striped","table-small"],[4,"ngFor","ngForOf"],["id","add-edit-modal","tabindex","-1","role","dialog",1,"modal","fade","modal-success"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-title"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-danger"],["type","button","data-dismiss","modal",1,"btn","btn-success"],[3,"ngValue"],[1,"btn","btn-success","form-control",3,"click"],[2,"vertical-align","top"],["style","cursor: pointer; color: rgb(35, 32, 224);",3,"click",4,"ngIf"],[2,"cursor","pointer","color","rgb(35, 32, 224)",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"section",0)(1,"div",1)(2,"h1"),e._uU(3,"Role"),e.qZA()()(),e.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"a",7)(10,"button",8),e._UZ(11,"i",9),e._uU(12,"Home"),e.qZA()(),e.TgZ(13,"button",10),e.NdJ("click",function(){return t.clearFields()}),e._UZ(14,"i",11),e._uU(15,"New"),e.qZA(),e.TgZ(16,"button",12),e.NdJ("click",function(){return t.edit()}),e._UZ(17,"i",13),e._uU(18,"Edit"),e.qZA(),e.TgZ(19,"button",14),e.NdJ("click",function(){return t.deleteRole(t.id)}),e._UZ(20,"i",15),e._uU(21,"Delete"),e.qZA(),e.TgZ(22,"button",16),e.NdJ("click",function(){return t.saveRole()}),e._UZ(23,"i",17),e._uU(24,"Save"),e.qZA()(),e.TgZ(25,"div",18)(26,"div",19),e._UZ(27,"br"),e.TgZ(28,"div",3)(29,"input",20),e.NdJ("ngModelChange",function(l){return t.id=l}),e.qZA(),e.TgZ(30,"div",21)(31,"label"),e._uU(32,"Role Name*"),e.qZA()(),e.TgZ(33,"div",22)(34,"input",23),e.NdJ("ngModelChange",function(l){return t.name=l}),e.qZA()(),e.TgZ(35,"datalist",24),e.YNc(36,T,2,2,"option",25),e.qZA(),e.TgZ(37,"div",26),e.YNc(38,M,2,0,"button",27),e.qZA()()(),e.TgZ(39,"div",28)(40,"div",3),e._UZ(41,"div",21)(42,"div",21),e.TgZ(43,"div",21)(44,"input",29),e.NdJ("ngModelChange",function(l){return t.filterRecords=l}),e.qZA()()(),e._UZ(45,"br"),e.TgZ(46,"table",30)(47,"thead")(48,"tr")(49,"td"),e._uU(50,"Role Name"),e.qZA(),e.TgZ(51,"td"),e._uU(52,"Owner"),e.qZA(),e.TgZ(53,"td"),e._uU(54,"Select"),e.qZA()()(),e.TgZ(55,"tbody"),e.YNc(56,E,7,3,"tr",31),e.ALo(57,"searchFilter"),e.qZA()()()()()()()(),e.TgZ(58,"div",32)(59,"div",33)(60,"div",34)(61,"div",35)(62,"button",36)(63,"span",37),e._uU(64,"\xd7"),e.qZA()(),e.TgZ(65,"h1",38),e._uU(66,"Add Role"),e.qZA()(),e._UZ(67,"div",39),e.TgZ(68,"div",40)(69,"button",41),e._uU(70,"Close"),e.qZA(),e.TgZ(71,"button",42),e._uU(72,"Save"),e.qZA()()()()()),2&n&&(e.xp6(22),e.Q6J("disabled",!1===t.enableSave),e.xp6(7),e.Q6J("ngModel",t.id),e.xp6(5),e.Q6J("readonly",t.nameLocked)("ngModel",t.name),e.xp6(2),e.Q6J("ngForOf",t.roles),e.xp6(2),e.Q6J("ngIf",t.grant(e.DdM(11,A))),e.xp6(6),e.Q6J("ngModel",t.filterRecords),e.xp6(12),e.Q6J("ngForOf",e.xi3(57,8,t.roles,t.filterRecords)))},dependencies:[m.ez,m.sg,m.O5,r.u5,r.YN,r.Kr,r.Fj,r.JJ,r.Q7,r.On,r.UX,f.G,h.rH]}),d})()}}]);