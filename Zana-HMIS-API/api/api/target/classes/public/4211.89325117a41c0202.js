"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[4211],{4211:(q,E,a)=>{a.r(E),a.d(E,{ProcedureReportComponent:()=>L});var p=a(5861),Z=a(553),C=a(775),g=a(9862),v=a(4716),A=a(7069),h=a(206),m=a(6814),u=a(95),t=a(6689),x=a(6466),D=a(7140),N=a(585),O=a(379),R=a(2848);function U(l,c){if(1&l){const e=t.EpF();t.TgZ(0,"option",23),t.NdJ("click",function(){const i=t.CHM(e).$implicit,o=t.oxw(2);return t.KtG(o.getClinician(i.id))}),t._uU(1),t.qZA()}if(2&l){const e=c.$implicit;t.xp6(1),t.lnq("",null==e?null:e.firstName," ",null==e?null:e.middleName," ",null==e?null:e.lastName," ")}}function I(l,c){if(1&l&&(t.TgZ(0,"div",3)(1,"div",4)(2,"select",21),t.YNc(3,U,2,3,"option",22),t.qZA()()()),2&l){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.clinicians)}}function S(l,c){if(1&l){const e=t.EpF();t.TgZ(0,"div",3)(1,"div",24)(2,"h4"),t._uU(3,"From"),t.qZA()(),t.TgZ(4,"div",25)(5,"input",26),t.NdJ("ngModelChange",function(n){t.CHM(e);const i=t.oxw();return t.KtG(i.startDate=n)}),t.qZA()(),t.TgZ(6,"div",24)(7,"h4"),t._uU(8,"To"),t.qZA()(),t.TgZ(9,"div",25)(10,"input",26),t.NdJ("ngModelChange",function(n){t.CHM(e);const i=t.oxw();return t.KtG(i.endDate=n)}),t.qZA()(),t.TgZ(11,"div",25)(12,"button",27),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.loadProcedureReport(n.startDate,n.endDate))}),t._uU(13,"Run Report"),t.qZA()(),t.TgZ(14,"div",24)(15,"button",27),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.clear())}),t._uU(16,"Clear"),t.qZA()()()}if(2&l){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.startDate),t.xp6(5),t.Q6J("ngModel",e.endDate)}}function y(l,c){if(1&l&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&l){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.insurancePlan?null:e.insurancePlan.name)}}function B(l,c){1&l&&(t.TgZ(0,"span"),t._uU(1,"Cash"),t.qZA())}function b(l,c){if(1&l&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t.YNc(10,y,2,1,"span",28),t.YNc(11,B,2,0,"span",28),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.ALo(14,"dateOnly"),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA()()),2&l){const e=c.$implicit;t.xp6(2),t.lnq("",null==e||null==e.patient?null:e.patient.firstName," ",null==e||null==e.patient?null:e.patient.middleName," ",null==e||null==e.patient?null:e.patient.lastName,""),t.xp6(2),t.Oqu(null==e||null==e.patient?null:e.patient.phoneNo),t.xp6(2),t.Oqu(null==e||null==e.patient?null:e.patient.no),t.xp6(2),t.Oqu(null==e||null==e.procedureType?null:e.procedureType.name),t.xp6(2),t.Q6J("ngIf","COVERED"===(null==e||null==e.patientBill?null:e.patientBill.status)),t.xp6(1),t.Q6J("ngIf","VERIFIED"===(null==e||null==e.patientBill?null:e.patientBill.status)||"PAID"===(null==e||null==e.patientBill?null:e.patientBill.status)||"UNPAID"===(null==e||null==e.patientBill?null:e.patientBill.status)),t.xp6(2),t.Oqu(t.lcZ(14,10,e.createdAt)),t.xp6(3),t.Oqu(null==e?null:e.status)}}var k=a(6236);const z=a(217),P=Z.N.apiUrl;let L=(()=>{var l;class c{constructor(r,n,i,o,_,f){var d=this;this.auth=r,this.http=n,this.modalService=i,this.spinner=o,this.msgBox=_,this.data=f,this.report=[],this.filterRecords="",this.procedures=[],this.clinicianLocked=!1,this.clinicianId=null,this.clinicianCode="",this.clinicianName="",this.clinicians=[],this.print=(0,p.Z)(function*(){if(0===d.procedures.length)return void d.msgBox.showErrorMessage3("No data to export");d.documentHeader=yield d.data.getDocumentHeader();var M=[[{text:"Patient Name",fontSize:9,fillColor:"#bdc6c7"},{text:"Phone",fontSize:9,fillColor:"#bdc6c7"},{text:"Reg#",fontSize:9,fillColor:"#bdc6c7"},{text:"Procedure",fontSize:9,fillColor:"#bdc6c7"},{text:"Mode",fontSize:9,fillColor:"#bdc6c7"},{text:"Date",fontSize:9,fillColor:"#bdc6c7"},{text:"Status",fontSize:9,fillColor:"#bdc6c7"}]];d.procedures.forEach(s=>{var T=[{text:(s?.patient?.firstName+" "+s.patient?.middleName+" "+s.patient?.lastName).toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.patient?.phoneNo.toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.patient?.no.toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.procedureType?.name.toString(),fontSize:9,fillColor:"#ffffff"},{text:s?.patient?.paymentType.toString(),fontSize:9,fillColor:"#ffffff"},{text:(new h.c).transform(s?.createdAt).toString(),fontSize:9,fillColor:"#ffffff"},{text:s.status.toString(),fontSize:9,fillColor:"#ffffff"}];M.push(T)});const W={header:"",footer:function(s,T){return s.toString()+" of "+T},content:[{columns:[d.documentHeader]},"  ",{text:"Procedures Report",fontSize:14,bold:!0,alignment:"center"},d.data.getHorizontalLine(),{layout:"noBorders",table:{widths:[80,80],body:[[{text:"From: "+d.startDate.toString(),fontSize:9},{text:"To: "+d.endDate.toString(),fontSize:9}]]}},"  ",{table:{headerRows:1,widths:[110,80,90,50,50,50,50],body:M}}]};A.createPdf(W).print()}),window.pdfMake.vfs=k.pdfMake.vfs}ngOnInit(){return(0,p.Z)(function*(){})()}loadProcedureReport(r,n){var i=this;return(0,p.Z)(function*(){let o={headers:(new g.WM).set("Authorization","Bearer "+i.auth.user.access_token)};if(void 0!==r&&void 0!==n)if(r>n)i.msgBox.showErrorMessage3("Could not run. Start date must be earlier or equal to end date");else{null===i.clinicianId&&i.msgBox.showErrorMessage3("Could not run. Please select Doctor");var _={from:r,to:n,clinician:{id:i.clinicianId}};i.spinner.show(),yield i.http.post(P+"/reports/procedure_report",_,o).pipe((0,v.x)(()=>i.spinner.hide())).toPromise().then(f=>{i.procedures=f,console.log(i.procedures)}).catch(f=>{i.msgBox.showErrorMessage(f,"")})}else i.msgBox.showErrorMessage3("Could not run. Please select date range")})()}clear(){this.procedures=[],this.clinicianId=null,this.clinicianName="",this.clinicianCode="",this.clinicians=[],this.clinicianLocked=!1}loadCliniciansLike(r){var n=this;return(0,p.Z)(function*(){if(n.clinicians=[],r.length<2)return;let i={headers:(new g.WM).set("Authorization","Bearer "+n.auth.user.access_token)};yield n.http.get(P+"/clinicians/load_clinicians_like?name_like="+r,i).toPromise().then(o=>{console.log(o),n.clinicians=o}).catch(o=>{n.msgBox.showErrorMessage(o,"")})})()}getClinician(r){var n=this;return(0,p.Z)(function*(){let i={headers:(new g.WM).set("Authorization","Bearer "+n.auth.user.access_token)};n.clinicians=[],n.spinner.show(),yield n.http.get(P+"/clinicians/get?id="+r,i).pipe((0,v.x)(()=>n.spinner.hide())).toPromise().then(o=>{n.clinicianId=o?.id,n.clinicianCode=o.code,n.clinicianName=o.firstName+" "+o.middleName+" "+o.lastName,n.clinicianLocked=!0}).catch(o=>{n.msgBox.showErrorMessage(o,""),console.log(o)})})()}exportToSpreadsheet(){var r=this;return(0,p.Z)(function*(){let n=new C.Workbook,i=n.addWorksheet("Procedure Report");i.columns=[{header:"Patient Name",key:"PATIENT_NAME"},{header:"Patient Phone",key:"PATIENT_PHONE"},{header:"Registration#",key:"REGISTRATION_NO"},{header:"Procedure",key:"PROCEDURE_TYPE"},{header:"Payment Mode",key:"PAYMENT_MODE"},{header:"Procedure Date",key:"CONSULTATION_DATE"},{header:"Status",key:"STATUS"}],r.spinner.show(),r.procedures.forEach(o=>{i.addRow({PATIENT_NAME:(o?.patient?.firstName+" "+o.patient?.middleName+" "+o.patient?.lastName).toString(),PATIENT_PHONE:o?.patient?.phoneNo,REGISTRATION_NO:o?.patient?.no,PROCEDURE_TYPE:o?.procedureType?.name,PAYMENT_MODE:o?.patient?.paymentType,CONSULTATION_DATE:(new h.c).transform(o?.createdAt),STATUS:o?.status},"n")}),r.spinner.hide(),n.xlsx.writeBuffer().then(o=>{let _=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});z.saveAs(_,"Procedures Report "+r.startDate.toString()+" to "+r.endDate.toString()+".xlsx")})})()}grant(r){var n=!1;return r.forEach(i=>{this.auth.checkPrivilege(i)&&(n=!0)}),n}}return(l=c).\u0275fac=function(r){return new(r||l)(t.Y36(x.e),t.Y36(g.eN),t.Y36(D.FF),t.Y36(N.t2),t.Y36(O.l),t.Y36(R.D))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-procedure-report"]],standalone:!0,features:[t.jDz],decls:49,vars:5,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["type","button",1,"btn","btn-success","btn-outline",3,"click"],[1,"fa","fa-print"],[1,"panel-body"],[1,"col-sm-3"],[1,"input-group"],["type","text","name","q","placeholder","Search Doctor...",1,"form-control",3,"ngModel","readonly","ngModelChange"],[1,"input-group-btn"],[1,"btn",3,"click"],[1,"fa","fa-times-rectangle"],["class","row",4,"ngIf"],[1,"col-sm-12",2,"height","100%","overflow","scroll"],[1,"table","table-responsive","table-hover","table-striped","table-small"],[2,"font-weight","bold"],[4,"ngFor","ngForOf"],["multiple","multiple",1,"form-control"],["style","height: 1cm; cursor: pointer; font-size: large;",3,"click",4,"ngFor","ngForOf"],[2,"height","1cm","cursor","pointer","font-size","large",3,"click"],[1,"col-sm-1"],[1,"col-sm-2"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","btn-outline",3,"click"],[4,"ngIf"]],template:function(r,n){1&r&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Procedures Report"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t.NdJ("click",function(){return n.print()}),t._UZ(10,"i",8),t._uU(11," Print"),t.qZA()(),t.TgZ(12,"div",9)(13,"div",3)(14,"div",4)(15,"div",3)(16,"div",10)(17,"h4"),t._uU(18,"Doctor Name"),t.qZA(),t.TgZ(19,"div",11)(20,"input",12),t.NdJ("ngModelChange",function(o){return n.clinicianName=o})("ngModelChange",function(o){return n.loadCliniciansLike(o)}),t.qZA(),t.TgZ(21,"span",13)(22,"button",14),t.NdJ("click",function(){return n.clear()}),t._UZ(23,"i",15),t.qZA()()(),t.YNc(24,I,4,1,"div",16),t.qZA()(),t._UZ(25,"hr"),t.YNc(26,S,17,2,"div",16),t.qZA()(),t.TgZ(27,"div",3)(28,"div",17),t._UZ(29,"hr"),t.TgZ(30,"table",18)(31,"thead")(32,"tr",19)(33,"td"),t._uU(34,"Patient Name"),t.qZA(),t.TgZ(35,"td"),t._uU(36,"Patient Phone"),t.qZA(),t.TgZ(37,"td"),t._uU(38,"Registration#"),t.qZA(),t.TgZ(39,"td"),t._uU(40,"Procedure"),t.qZA(),t.TgZ(41,"td"),t._uU(42,"Payment Mode"),t.qZA(),t.TgZ(43,"td"),t._uU(44,"Procedure Date"),t.qZA(),t.TgZ(45,"td"),t._uU(46,"Status"),t.qZA()()(),t.TgZ(47,"tbody"),t.YNc(48,b,17,12,"tr",20),t.qZA()()()()()()()()()),2&r&&(t.xp6(20),t.Q6J("ngModel",n.clinicianName)("readonly",n.clinicianLocked),t.xp6(4),t.Q6J("ngIf",n.clinicians.length>0),t.xp6(2),t.Q6J("ngIf",null!=n.clinicianId),t.xp6(22),t.Q6J("ngForOf",n.procedures))},dependencies:[m.ez,m.sg,m.O5,u.u5,u.YN,u.Kr,u.Fj,u.JJ,u.On,u.UX,h.c]}),c})()}}]);