"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[1244],{1244:(I,C,a)=>{a.r(C),a.d(C,{LabTestReportComponent:()=>S});var f=a(5861),E=a(553),Z=a(775),c=a(6814),v=a(7069),d=a(95),M=a(4512),g=a(9862),A=a(4716),t=a(6689),y=a(6466),O=a(585),U=a(379),x=a(2848);function R(l,_){if(1&l){const r=t.EpF();t.TgZ(0,"option",21),t.NdJ("click",function(){const o=t.CHM(r).$implicit,n=t.oxw(2);return t.KtG(n.getLabTestType(o.id))}),t._uU(1),t.qZA()}if(2&l){const r=_.$implicit;t.xp6(1),t.Oqu(r.name)}}function N(l,_){if(1&l&&(t.TgZ(0,"div",3)(1,"div",4)(2,"select",19),t.YNc(3,R,2,1,"option",20),t.qZA()()()),2&l){const r=t.oxw();t.xp6(3),t.Q6J("ngForOf",r.labTestTypes)}}function P(l,_){if(1&l&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"age"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.qZA(),t.TgZ(18,"td"),t._uU(19),t.qZA(),t._UZ(20,"td"),t.qZA()),2&l){const r=_.$implicit;t.xp6(2),t.Oqu(r.sn),t.xp6(2),t.lnq("",r.patient.firstName," ",r.patient.middleName," ",r.patient.lastName,""),t.xp6(2),t.Oqu(t.lcZ(7,11,r.patient.dateOfBirth)),t.xp6(3),t.Oqu(r.patient.no),t.xp6(2),t.Oqu(r.patient.gender),t.xp6(2),t.Oqu(null==r?null:r.membershipNo),t.xp6(2),t.Oqu(r.patient.phoneNo),t.xp6(2),t.Oqu(null==r?null:r.paymentType),t.xp6(2),t.Oqu(r.result)}}var D=a(6236);const L=a(217),m=E.N.apiUrl;let S=(()=>{var l;class _{constructor(s,e,o,n,T){var i=this;this.auth=s,this.http=e,this.spinner=o,this.msgBox=n,this.data=T,this.report=[],this.filterRecords="",this.labTests=[],this.labTestTypeId=null,this.labTestTypeCode="",this.labTestTypeName="",this.labTestTypes=[],this.print=(0,f.Z)(function*(){if(0===i.labTests.length)return void i.msgBox.showErrorMessage3("No data to print");i.documentHeader=yield i.data.getDocumentHeader();var h=[[{text:"SN",fontSize:6,fillColor:"#bdc6c7"},{text:"Patient Name",fontSize:6,fillColor:"#bdc6c7"},{text:"Age",fontSize:6,fillColor:"#bdc6c7"},{text:"File No",fontSize:6,fillColor:"#bdc6c7"},{text:"Gender",fontSize:6,fillColor:"#bdc6c7"},{text:"Card No",fontSize:6,fillColor:"#bdc6c7"},{text:"Phone No",fontSize:6,fillColor:"#bdc6c7"},{text:"Payment Mode",fontSize:6,fillColor:"#bdc6c7"},{text:"Results",fontSize:6,fillColor:"#bdc6c7"}]];i.labTests.forEach(p=>{var b=[{text:p.sn.toString(),fontSize:6,fillColor:"#ffffff"},{text:p.patient.firstName+" "+p.patient.middleName+" "+p.patient.lastName,fontSize:6,fillColor:"#ffffff"},{text:(new M.C).transform(p.patient.dateOfBirth),fontSize:6,fillColor:"#ffffff"},{text:p.patient.no,fontSize:6,fillColor:"#ffffff"},{text:p.patient.gender,fontSize:6,fillColor:"#ffffff"},{text:p.membershipNo,fontSize:6,fillColor:"#ffffff"},{text:p.patient.phoneNo,fontSize:6,fillColor:"#ffffff"},{text:p.paymentType,fontSize:6,fillColor:"#ffffff"},{text:p.result,fontSize:6,fillColor:"#ffffff"}];h.push(b)});const B={header:"",footer:function(p,b){return p.toString()+" of "+b},content:[{columns:[i.documentHeader]},"  ",{text:"Lab Test Report",fontSize:14,bold:!0,alignment:"center"},i.data.getHorizontalLine()," ","Test: "+i.labTestTypeName," ",{layout:"noBorders",table:{widths:[80,80],body:[[{text:"From: "+i.from.toString(),fontSize:9},{text:"To: "+i.to.toString(),fontSize:9}]]}},"  ",{table:{headerRows:1,widths:[20,90,80,50,20,40,40,40,50],body:h}}]};v.createPdf(B).print()}),window.pdfMake.vfs=D.pdfMake.vfs}ngOnInit(){return(0,f.Z)(function*(){})()}loadLabTestReport(s,e){var o=this;return(0,f.Z)(function*(){let n={headers:(new g.WM).set("Authorization","Bearer "+o.auth.user.access_token)};if(void 0!==s&&void 0!==e)if(null!==o.labTestTypeId)if(s>e)o.msgBox.showErrorMessage3("Could not run. Start date must be earlier or equal to end date");else{var T={from:s,to:e,labTestType:{id:o.labTestTypeId}};o.spinner.show(),yield o.http.post(m+"/reports/lab_test_report",T,n).pipe((0,A.x)(()=>o.spinner.hide())).toPromise().then(i=>{console.log(i),o.labTests=i;var u=1;o.labTests.forEach(h=>{h.sn=u,u+=1})}).catch(i=>{console.log(i),o.msgBox.showErrorMessage(i,"")})}else o.msgBox.showErrorMessage3("Could not run. Please select lab test");else o.msgBox.showErrorMessage3("Could not run. Please select date range")})()}clear(){this.labTests=[]}loadLabTestTypesLike(s){var e=this;return(0,f.Z)(function*(){if(e.labTestTypes=[],s.length<2)return;let o={headers:(new g.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.labTestTypes=[],yield e.http.get(m+"/lab_test_types/load_lab_test_types_like?name_like="+s,o).toPromise().then(n=>{console.log(n),e.labTestTypes=n}).catch(n=>{e.msgBox.showErrorMessage(n,"")})})()}getLabTestType(s){var e=this;return(0,f.Z)(function*(){let o={headers:(new g.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.labTestTypes=[],e.spinner.show(),yield e.http.get(m+"/lab_test_types/get?id="+s,o).pipe((0,A.x)(()=>e.spinner.hide())).toPromise().then(n=>{e.labTestTypeId=n?.id,e.labTestTypeCode=n.code,e.labTestTypeName=n.name}).catch(n=>{e.msgBox.showErrorMessage(n,""),console.log(n)})})()}exportToSpreadsheet(){var s=this;return(0,f.Z)(function*(){let e=new Z.Workbook,o=e.addWorksheet("Daily Sales Report");o.columns=[{header:"DATE",key:"DATE"},{header:"AMOUNT",key:"AMOUNT"},{header:"DISCOUNT",key:"DISCOUNT"},{header:"TAX",key:"TAX"}],s.spinner.show(),s.report.forEach(()=>{o.addRow({DATE:(0,c.p6)("","yyyy-MM-dd","en-US"),AMOUNT:"",DISCOUNT:"",TAX:""},"n")}),o.addRow({CODE:"",DESCRIPTION:"",QTY:"Total",AMOUNT:""},"n"),s.spinner.hide(),e.xlsx.writeBuffer().then(n=>{let T=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});L.saveAs(T,"Report Template "+s.from+" to "+s.to+".xlsx")})})()}grant(s){var e=!1;return s.forEach(o=>{this.auth.checkPrivilege(o)&&(e=!0)}),e}}return(l=_).\u0275fac=function(s){return new(s||l)(t.Y36(y.e),t.Y36(g.eN),t.Y36(O.t2),t.Y36(U.l),t.Y36(x.D))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-lab-test-report"]],standalone:!0,features:[t.jDz],decls:65,vars:5,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["type","button",1,"btn","btn-success","btn-outline",3,"click"],[1,"fa","fa-print"],[1,"panel-body"],[1,"col-sm-3"],["type","text","placeholder","Search Lab Test...",1,"form-control",3,"ngModel","ngModelChange"],["class","row",4,"ngIf"],[1,"col-sm-1"],[1,"col-sm-2"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","btn-outline",3,"click"],[1,"table","table-responsive","table-small","table-striped","table-bordered"],[4,"ngFor","ngForOf"],["multiple","multiple","size","4",1,"form-control"],["style","height: 1cm; cursor: pointer; font-size: large;",3,"click",4,"ngFor","ngForOf"],[2,"height","1cm","cursor","pointer","font-size","large",3,"click"]],template:function(s,e){1&s&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Lab Tests Report"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t.NdJ("click",function(){return e.print()}),t._UZ(10,"i",8),t._uU(11," Print"),t.qZA()(),t.TgZ(12,"div",9)(13,"div",3)(14,"div",4),t._UZ(15,"div",3),t.TgZ(16,"div",3)(17,"div",10)(18,"input",11),t.NdJ("ngModelChange",function(n){return e.labTestTypeName=n})("ngModelChange",function(n){return e.loadLabTestTypesLike(n)}),t.qZA(),t.YNc(19,N,4,1,"div",12),t._UZ(20,"br"),t.qZA(),t.TgZ(21,"div",13)(22,"h4"),t._uU(23,"From"),t.qZA()(),t.TgZ(24,"div",14)(25,"input",15),t.NdJ("ngModelChange",function(n){return e.from=n}),t.qZA()(),t.TgZ(26,"div",13)(27,"h4"),t._uU(28,"To"),t.qZA()(),t.TgZ(29,"div",14)(30,"input",15),t.NdJ("ngModelChange",function(n){return e.to=n}),t.qZA()(),t.TgZ(31,"div",14)(32,"button",16),t.NdJ("click",function(){return e.loadLabTestReport(e.from,e.to)}),t._uU(33,"Run Report"),t.qZA()(),t.TgZ(34,"div",13)(35,"button",16),t.NdJ("click",function(){return e.clear()}),t._uU(36,"Clear"),t.qZA()()()()(),t.TgZ(37,"div",3),t._UZ(38,"hr"),t.TgZ(39,"div",4)(40,"table",17)(41,"thead")(42,"tr")(43,"td"),t._uU(44,"SN"),t.qZA(),t.TgZ(45,"td"),t._uU(46,"Patient Name"),t.qZA(),t.TgZ(47,"td"),t._uU(48,"Age"),t.qZA(),t.TgZ(49,"td"),t._uU(50,"File No"),t.qZA(),t.TgZ(51,"td"),t._uU(52,"Gender"),t.qZA(),t.TgZ(53,"td"),t._uU(54,"Card No"),t.qZA(),t.TgZ(55,"td"),t._uU(56,"Phone No"),t.qZA(),t.TgZ(57,"td"),t._uU(58,"Payment Mode"),t.qZA(),t.TgZ(59,"td"),t._uU(60,"Results"),t.qZA(),t.TgZ(61,"td"),t._uU(62,"Dr. Report"),t.qZA()()(),t.TgZ(63,"tbody"),t.YNc(64,P,21,13,"tr",18),t.qZA()()()()()()()()()),2&s&&(t.xp6(18),t.Q6J("ngModel",e.labTestTypeName),t.xp6(1),t.Q6J("ngIf",e.labTestTypes.length>0),t.xp6(6),t.Q6J("ngModel",e.from),t.xp6(5),t.Q6J("ngModel",e.to),t.xp6(34),t.Q6J("ngForOf",e.labTests))},dependencies:[c.ez,c.sg,c.O5,d.u5,d.YN,d.Kr,d.Fj,d.JJ,d.On,d.UX,M.C]}),_})()}}]);