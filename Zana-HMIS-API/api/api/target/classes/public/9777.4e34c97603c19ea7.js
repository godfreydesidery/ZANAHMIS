"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[9777],{9777:(z,C,l)=>{l.r(C),l.d(C,{LabSampleCollectionReportComponent:()=>y});var c=l(5861),v=l(553),h=l(775),m=l(6814),E=l(7069),p=l(95),Z=l(4512),A=l(9862),b=l(4716),t=l(6689),M=l(6466),O=l(585),U=l(379),S=l(2848);function D(f,T){if(1&f&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"age"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.qZA(),t.TgZ(18,"td"),t._uU(19),t.qZA(),t.TgZ(20,"td"),t._uU(21),t.qZA()()),2&f){const o=T.$implicit;t.xp6(2),t.Oqu(o.sn),t.xp6(2),t.lnq("",o.patient.firstName," ",o.patient.middleName," ",o.patient.lastName,""),t.xp6(2),t.Oqu(o.patient.no),t.xp6(2),t.Oqu(t.lcZ(9,12,o.patient.dateOfBirth)),t.xp6(3),t.Oqu(null==o?null:o.paymentType),t.xp6(2),t.Oqu(null==o||null==o.labTestType?null:o.labTestType.name),t.xp6(2),t.Oqu(null==o?null:o.status),t.xp6(2),t.Oqu(null==o?null:o.collected),t.xp6(2),t.Oqu(null==o?null:o.verified),t.xp6(2),t.Oqu(null==o?null:o.rejectComment)}}var R=l(6236);const x=l(217),P=v.N.apiUrl;let y=(()=>{var f;class T{constructor(a,n,e,s,_){var i=this;this.auth=a,this.http=n,this.spinner=e,this.msgBox=s,this.data=_,this.report=[],this.filterRecords="",this.labTests=[],this.displayedTests=[],this.print=(0,c.Z)(function*(){if(0===i.labTests.length)return void i.msgBox.showErrorMessage3("No data to print");i.documentHeader=yield i.data.getDocumentHeader();var d=[[{text:"SN",fontSize:6,fillColor:"#bdc6c7"},{text:"Patient Name",fontSize:6,fillColor:"#bdc6c7"},{text:"File No",fontSize:6,fillColor:"#bdc6c7"},{text:"Age",fontSize:6,fillColor:"#bdc6c7"},{text:"Payment Mode",fontSize:6,fillColor:"#bdc6c7"},{text:"Test Name",fontSize:6,fillColor:"#bdc6c7"},{text:"Status",fontSize:6,fillColor:"#bdc6c7"},{text:"Collected",fontSize:6,fillColor:"#bdc6c7"},{text:"Verified",fontSize:6,fillColor:"#bdc6c7"},{text:"Reject Reason",fontSize:6,fillColor:"#bdc6c7"}]];i.displayedTests.forEach(r=>{var g=[{text:r.sn.toString(),fontSize:6,fillColor:"#ffffff"},{text:r.patient.firstName+" "+r.patient.middleName+" "+r.patient.lastName,fontSize:6,fillColor:"#ffffff"},{text:r.patient.no,fontSize:6,fillColor:"#ffffff"},{text:(new Z.C).transform(r.patient.dateOfBirth),fontSize:6,fillColor:"#ffffff"},{text:r.paymentType,fontSize:6,fillColor:"#ffffff"},{text:r.labTestType.name,fontSize:6,fillColor:"#ffffff"},{text:r.status,fontSize:6,fillColor:"#ffffff"},{text:r.collected,fontSize:6,fillColor:"#ffffff"},{text:r.verified,fontSize:6,fillColor:"#ffffff"},{text:r.rejectComment,fontSize:6,fillColor:"#ffffff"}];d.push(g)});const N={header:"",footer:function(r,g){return r.toString()+" of "+g},content:[{columns:[i.documentHeader]},"  ",{text:"Lab Sample Collection Report",fontSize:14,bold:!0,alignment:"center"},i.data.getHorizontalLine()," ",{layout:"noBorders",table:{widths:[80,80],body:[[{text:"From: "+i.from.toString(),fontSize:9},{text:"To: "+i.to.toString(),fontSize:9}]]}},"  ",{table:{headerRows:1,widths:[20,50,50,50,40,40,40,40,50,50],body:d}}]};E.createPdf(N).print()}),window.pdfMake.vfs=R.pdfMake.vfs}ngOnInit(){return(0,c.Z)(function*(){})()}loadLabTestReport(a,n){var e=this;return(0,c.Z)(function*(){let s={headers:(new A.WM).set("Authorization","Bearer "+e.auth.user.access_token)};if(void 0!==a&&void 0!==n)if(a>n)e.msgBox.showErrorMessage3("Could not run. Start date must be earlier or equal to end date");else{var _={from:a,to:n};e.spinner.show(),yield e.http.post(P+"/reports/lab_sample_collection_report",_,s).pipe((0,b.x)(()=>e.spinner.hide())).toPromise().then(i=>{console.log(i),e.labTests=i,e.displayedTests=[],e.labTests.forEach(d=>{("COLLECTED"===d.status||"VERIFIED"===d.status||"REJECTED"===d.status)&&e.displayedTests.push(d)});var u=1;e.displayedTests.forEach(d=>{d.sn=u,u+=1})}).catch(i=>{console.log(i),e.msgBox.showErrorMessage(i,"")})}else e.msgBox.showErrorMessage3("Could not run. Please select date range")})()}clear(){this.labTests=[],this.displayedTests=[]}exportToSpreadsheet(){var a=this;return(0,c.Z)(function*(){let n=new h.Workbook,e=n.addWorksheet("Daily Sales Report");e.columns=[{header:"DATE",key:"DATE"},{header:"AMOUNT",key:"AMOUNT"},{header:"DISCOUNT",key:"DISCOUNT"},{header:"TAX",key:"TAX"}],a.spinner.show(),a.report.forEach(()=>{e.addRow({DATE:(0,m.p6)("","yyyy-MM-dd","en-US"),AMOUNT:"",DISCOUNT:"",TAX:""},"n")}),e.addRow({CODE:"",DESCRIPTION:"",QTY:"Total",AMOUNT:""},"n"),a.spinner.hide(),n.xlsx.writeBuffer().then(s=>{let _=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});x.saveAs(_,"Report Template "+a.from+" to "+a.to+".xlsx")})})()}grant(a){var n=!1;return a.forEach(e=>{this.auth.checkPrivilege(e)&&(n=!0)}),n}}return(f=T).\u0275fac=function(a){return new(a||f)(t.Y36(M.e),t.Y36(A.eN),t.Y36(O.t2),t.Y36(U.l),t.Y36(S.D))},f.\u0275cmp=t.Xpm({type:f,selectors:[["app-lab-sample-collection-report"]],standalone:!0,features:[t.jDz],decls:60,vars:3,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["type","button",1,"btn","btn-success","btn-outline",3,"click"],[1,"fa","fa-print"],[1,"panel-body"],[1,"col-sm-1"],[1,"col-sm-2"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","btn-outline",3,"click"],[1,"table","table-responsive","table-small","table-striped","table-bordered"],[4,"ngFor","ngForOf"]],template:function(a,n){1&a&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Lab Sample Collection Report"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t.NdJ("click",function(){return n.print()}),t._UZ(10,"i",8),t._uU(11," Print"),t.qZA()(),t.TgZ(12,"div",9)(13,"div",3)(14,"div",4)(15,"div",3)(16,"div",10)(17,"h4"),t._uU(18,"From"),t.qZA()(),t.TgZ(19,"div",11)(20,"input",12),t.NdJ("ngModelChange",function(s){return n.from=s}),t.qZA()(),t.TgZ(21,"div",10)(22,"h4"),t._uU(23,"To"),t.qZA()(),t.TgZ(24,"div",11)(25,"input",12),t.NdJ("ngModelChange",function(s){return n.to=s}),t.qZA()(),t.TgZ(26,"div",11)(27,"button",13),t.NdJ("click",function(){return n.loadLabTestReport(n.from,n.to)}),t._uU(28,"Run Report"),t.qZA()(),t.TgZ(29,"div",10)(30,"button",13),t.NdJ("click",function(){return n.clear()}),t._uU(31,"Clear"),t.qZA()()()()(),t.TgZ(32,"div",3),t._UZ(33,"hr"),t.TgZ(34,"div",4)(35,"table",14)(36,"thead")(37,"tr")(38,"td"),t._uU(39,"SN"),t.qZA(),t.TgZ(40,"td"),t._uU(41,"Patient Name"),t.qZA(),t.TgZ(42,"td"),t._uU(43,"File No"),t.qZA(),t.TgZ(44,"td"),t._uU(45,"Age"),t.qZA(),t.TgZ(46,"td"),t._uU(47,"Payment Mode"),t.qZA(),t.TgZ(48,"td"),t._uU(49,"Test Name"),t.qZA(),t.TgZ(50,"td"),t._uU(51,"Status"),t.qZA(),t.TgZ(52,"td"),t._uU(53,"Collected"),t.qZA(),t.TgZ(54,"td"),t._uU(55,"Verified"),t.qZA(),t.TgZ(56,"td"),t._uU(57,"Rejected Reason"),t.qZA()()(),t.TgZ(58,"tbody"),t.YNc(59,D,22,14,"tr",15),t.qZA()()()()()()()()()),2&a&&(t.xp6(20),t.Q6J("ngModel",n.from),t.xp6(5),t.Q6J("ngModel",n.to),t.xp6(34),t.Q6J("ngForOf",n.displayedTests))},dependencies:[m.ez,m.sg,p.u5,p.Fj,p.JJ,p.On,p.UX,Z.C]}),T})()}}]);