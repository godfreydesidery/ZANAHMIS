"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[1608],{1608:(B,v,s)=>{s.r(v),s.d(v,{MedicinePriceComponent:()=>D});var g=s(5861),p=s(6814),m=s(9862),_=s(95),h=s(4716),C=s(4185),I=s(553),e=s(6689),E=s(6466),Z=s(1581),f=s(585),T=s(379);function A(a,l){if(1&a){const c=e.EpF();e.TgZ(0,"span"),e._uU(1,"COVERED "),e.TgZ(2,"button",19),e.NdJ("click",function(){e.CHM(c);const n=e.oxw(2).$implicit,t=e.oxw();return e.KtG(t.changeMedicineCoverage(t.insurancePlanId,null==n||null==n.medicineInsurancePlan||null==n.medicineInsurancePlan.medicine?null:n.medicineInsurancePlan.medicine.id,!1))}),e._uU(3,"Change"),e.qZA()()}}function x(a,l){if(1&a){const c=e.EpF();e.TgZ(0,"span"),e._uU(1,"NOT COVERED "),e.TgZ(2,"button",19),e.NdJ("click",function(){e.CHM(c);const n=e.oxw(2).$implicit,t=e.oxw();return e.KtG(t.changeMedicineCoverage(t.insurancePlanId,null==n||null==n.medicineInsurancePlan||null==n.medicineInsurancePlan.medicine?null:n.medicineInsurancePlan.medicine.id,!0))}),e._uU(3,"Change"),e.qZA()()}}function O(a,l){if(1&a&&(e.TgZ(0,"div"),e.YNc(1,A,4,0,"span",18),e.YNc(2,x,4,0,"span",18),e.qZA()),2&a){const c=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!0===(null==c||null==c.medicineInsurancePlan?null:c.medicineInsurancePlan.covered)),e.xp6(1),e.Q6J("ngIf",!1===(null==c||null==c.medicineInsurancePlan?null:c.medicineInsurancePlan.covered))}}function U(a,l){if(1&a){const c=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td",14),e._uU(6),e.ALo(7,"currency"),e.qZA(),e.TgZ(8,"td")(9,"input",15),e.NdJ("ngModelChange",function(n){const i=e.CHM(c).$implicit;return e.KtG(i.price=n)}),e.qZA()(),e.TgZ(10,"td")(11,"button",16),e.NdJ("click",function(){const t=e.CHM(c).$implicit,i=e.oxw();return e.KtG(i.updateMedicinePriceByInsurance(i.insurancePlanId,null==t||null==t.medicine?null:t.medicine.id,t.price))}),e._UZ(12,"i",17),e._uU(13,"Save"),e.qZA()(),e.TgZ(14,"td"),e.YNc(15,O,3,2,"div",18),e.qZA()()}if(2&a){const c=l.$implicit;e.xp6(2),e.Oqu(c.medicine.id),e.xp6(2),e.Oqu(c.medicine.name),e.xp6(2),e.Oqu(e.Dn7(7,5,c.price,"","")),e.xp6(3),e.Q6J("ngModel",c.price),e.xp6(6),e.Q6J("ngIf",null!=(null==c||null==c.medicineInsurancePlan?null:c.medicineInsurancePlan.covered))}}const P=I.N.apiUrl;let D=(()=>{var a;class l{constructor(r,n,t,i,u){this.auth=r,this.http=n,this.modalService=t,this.spinner=i,this.msgBox=u,this.insurancePlanId=null,this.insurancePlanName="",this.medicines=[],this.medicinePrices=[],this.filterRecords=""}ngOnInit(){this.insurancePlanId=localStorage.getItem("insurance_plan_id"),this.insurancePlanName=localStorage.getItem("insurance_plan_name"),localStorage.removeItem("insurance_plan_id"),localStorage.removeItem("insurance_plan_name"),this.loadMedicinesByInsurance(this.insurancePlanId)}loadMedicinesByInsurance(r){var n=this;return(0,g.Z)(function*(){n.medicines=[];let t={headers:(new m.WM).set("Authorization","Bearer "+n.auth.user.access_token)};n.spinner.show(),yield n.http.get(P+"/insurance_plans/get_medicine_prices?insurance_plan_id="+r,t).pipe((0,h.x)(()=>n.spinner.hide())).toPromise().then(i=>{n.medicinePrices=i}).catch(i=>{n.msgBox.showErrorMessage(i,"Could not load medicines")})})()}changeMedicineCoverage(r,n,t){var i=this;return(0,g.Z)(function*(){let u={headers:(new m.WM).set("Authorization","Bearer "+i.auth.user.access_token)};var M={medicine:{id:n},medicineInsurancePlan:{insurancePlan:{id:r},covered:t}};i.spinner.show(),yield i.http.post(P+"/insurance_plans/change_medicine_coverage",M,u).pipe((0,h.x)(()=>i.spinner.hide())).toPromise().then(o=>{i.medicinePrices.forEach(d=>{o.medicine.id===d.medicine.id&&(d.medicineInsurancePlan.covered=o.medicineInsurancePlan.covered)})}).catch(o=>{i.msgBox.showErrorMessage(o,"Could not change coverage")})})()}updateMedicinePriceByInsurance(r,n,t){var i=this;return(0,g.Z)(function*(){let u={headers:(new m.WM).set("Authorization","Bearer "+i.auth.user.access_token)};var M={medicine:{id:n},medicineInsurancePlan:{insurancePlan:{id:r}},price:t};i.spinner.show(),yield i.http.post(P+"/insurance_plans/update_medicine_price_by_insurance",M,u).pipe((0,h.x)(()=>i.spinner.hide())).toPromise().then(o=>{i.medicinePrices.forEach(d=>{o.medicine.id===d.medicine.id&&(d.price=o.price,d.covered=o.covered)}),i.msgBox.showSuccessMessage("Price updated successifully")}).catch(o=>{i.msgBox.showErrorMessage(o,"Could not update price")})})()}}return(a=l).\u0275fac=function(r){return new(r||a)(e.Y36(E.e),e.Y36(m.eN),e.Y36(Z.FF),e.Y36(f.t2),e.Y36(T.l))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-medicine-price"]],standalone:!0,features:[e.jDz],decls:37,vars:6,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],[1,"text-primary"],[1,"panel-body"],[1,"col-sm-12",2,"height","100%","overflow","scroll"],[1,"col-sm-4"],["type","text","placeholder","Search...",1,"form-control","pull-right",2,"max-width","8cm",3,"ngModel","ngModelChange"],[1,"table","table-bordered","table-small"],[4,"ngFor","ngForOf"],[2,"text-align","right"],["type","text",1,"form-control",2,"text-align","center",3,"ngModel","ngModelChange"],[1,"btn","btn-success",3,"click"],[1,"glyphicon","glyphicon-floppy-disk"],[4,"ngIf"],[3,"click"]],template:function(r,n){1&r&&(e.TgZ(0,"section",0)(1,"div",1)(2,"h1"),e._uU(3,"Medicine Prices"),e.qZA()()(),e.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"h4",7),e._uU(10),e.qZA()(),e.TgZ(11,"div",8)(12,"div",9)(13,"div",3),e._UZ(14,"div",10)(15,"div",10),e.TgZ(16,"div",10)(17,"input",11),e.NdJ("ngModelChange",function(i){return n.filterRecords=i}),e.qZA()()(),e._UZ(18,"br"),e.TgZ(19,"table",12)(20,"thead")(21,"tr")(22,"td"),e._uU(23,"ID"),e.qZA(),e.TgZ(24,"td"),e._uU(25,"Medicine"),e.qZA(),e.TgZ(26,"td"),e._uU(27,"Price"),e.qZA(),e.TgZ(28,"td"),e._uU(29,"Edit Price"),e.qZA(),e.TgZ(30,"td"),e._uU(31,"Action"),e.qZA(),e.TgZ(32,"td"),e._uU(33,"Coverage"),e.qZA()()(),e.TgZ(34,"tbody"),e.YNc(35,U,16,9,"tr",13),e.ALo(36,"searchFilter"),e.qZA()()()()()()()()),2&r&&(e.xp6(10),e.hij("Package: ",n.insurancePlanName,""),e.xp6(7),e.Q6J("ngModel",n.filterRecords),e.xp6(18),e.Q6J("ngForOf",e.xi3(36,3,n.medicinePrices,n.filterRecords)))},dependencies:[p.ez,p.sg,p.O5,p.H9,_.u5,_.Fj,_.JJ,_.On,_.UX,C.G]}),l})()}}]);