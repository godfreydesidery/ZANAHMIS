"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[4226],{4226:(w,v,s)=>{s.r(v),s.d(v,{ConsultationReportComponent:()=>z});var d=s(5861),P=s(553),E=s(775),h=s(9862),M=s(4716),A=s(7069),g=s(206),m=s(6814),_=s(95),t=s(6689),x=s(6466),N=s(7140),D=s(585),O=s(379),R=s(2848);function U(a,r){if(1&a){const n=t.EpF();t.TgZ(0,"option",23),t.NdJ("click",function(){const i=t.CHM(n).$implicit,e=t.oxw(2);return t.KtG(e.getClinician(i.id))}),t._uU(1),t.qZA()}if(2&a){const n=r.$implicit;t.xp6(1),t.lnq("",null==n?null:n.firstName," ",null==n?null:n.middleName," ",null==n?null:n.lastName," ")}}function I(a,r){if(1&a&&(t.TgZ(0,"div",3)(1,"div",4)(2,"select",21),t.YNc(3,U,2,3,"option",22),t.qZA()()()),2&a){const n=t.oxw();t.xp6(3),t.Q6J("ngForOf",n.clinicians)}}function S(a,r){if(1&a){const n=t.EpF();t.TgZ(0,"div",3)(1,"div",24)(2,"h4"),t._uU(3,"From"),t.qZA()(),t.TgZ(4,"div",25)(5,"input",26),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.startDate=o)}),t.qZA()(),t.TgZ(6,"div",24)(7,"h4"),t._uU(8,"To"),t.qZA()(),t.TgZ(9,"div",25)(10,"input",26),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.endDate=o)}),t.qZA()(),t.TgZ(11,"div",25)(12,"button",27),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.loadConsultationReport(o.startDate,o.endDate))}),t._uU(13,"Run Report"),t.qZA()(),t.TgZ(14,"div",24)(15,"button",27),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.clear())}),t._uU(16,"Clear"),t.qZA()()()}if(2&a){const n=t.oxw();t.xp6(5),t.Q6J("ngModel",n.startDate),t.xp6(5),t.Q6J("ngModel",n.endDate)}}function B(a,r){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&a){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(null==n||null==n.insurancePlan?null:n.insurancePlan.name)}}function b(a,r){1&a&&(t.TgZ(0,"span"),t._uU(1,"Cash"),t.qZA())}function k(a,r){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.YNc(8,B,2,1,"span",28),t.YNc(9,b,2,0,"span",28),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"dateOnly"),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA()()),2&a){const n=r.$implicit;t.xp6(2),t.lnq("",null==n||null==n.patient?null:n.patient.firstName," ",null==n||null==n.patient?null:n.patient.middleName," ",null==n||null==n.patient?null:n.patient.lastName,""),t.xp6(2),t.Oqu(null==n||null==n.patient?null:n.patient.phoneNo),t.xp6(2),t.Oqu(null==n||null==n.patient?null:n.patient.no),t.xp6(2),t.Q6J("ngIf","COVERED"===(null==n||null==n.patientBill?null:n.patientBill.status)),t.xp6(1),t.Q6J("ngIf","VERIFIED"===(null==n||null==n.patientBill?null:n.patientBill.status)||"PAID"===(null==n||null==n.patientBill?null:n.patientBill.status)||"UNPAID"===(null==n||null==n.patientBill?null:n.patientBill.status)),t.xp6(2),t.Oqu(t.lcZ(12,9,n.createdAt)),t.xp6(3),t.Oqu(null==n?null:n.status)}}var y=s(6236);const L=s(217),C=P.N.apiUrl;let z=(()=>{var a;class r{constructor(l,o,i,e,p,f){var c=this;this.auth=l,this.http=o,this.modalService=i,this.spinner=e,this.msgBox=p,this.data=f,this.report=[],this.filterRecords="",this.consultations=[],this.clinicianLocked=!1,this.clinicianId=null,this.clinicianCode="",this.clinicianName="",this.clinicians=[],this.print=(0,d.Z)(function*(){if(0===c.consultations.length)return void c.msgBox.showErrorMessage3("No data to print");c.documentHeader=yield c.data.getDocumentHeader();var Z=[[{text:"Patient Name",fontSize:9,fillColor:"#bdc6c7"},{text:"Phone",fontSize:9,fillColor:"#bdc6c7"},{text:"Reg#",fontSize:9,fillColor:"#bdc6c7"},{text:"Mode",fontSize:9,fillColor:"#bdc6c7"},{text:"Date",fontSize:9,fillColor:"#bdc6c7"},{text:"Status",fontSize:9,fillColor:"#bdc6c7"}]];c.consultations.forEach(u=>{var T=[{text:(u?.patient?.firstName+" "+u.patient?.middleName+" "+u.patient?.lastName).toString(),fontSize:9,fillColor:"#ffffff"},{text:u?.patient?.phoneNo.toString(),fontSize:9,fillColor:"#ffffff"},{text:u?.patient?.no.toString(),fontSize:9,fillColor:"#ffffff"},{text:u?.insurancePlan?.name.toString(),fontSize:9,fillColor:"#ffffff"},{text:(new g.c).transform(u?.createdAt),fontSize:9,fillColor:"#ffffff"},{text:u?.status.toString(),fontSize:9,fillColor:"#ffffff"}];Z.push(T)});const W={header:"",footer:function(u,T){return u.toString()+" of "+T},content:[{columns:[c.documentHeader]},"  ",{text:"Consultations Report",fontSize:14,bold:!0,alignment:"center"},c.data.getHorizontalLine()," ","Doctor: "+c.clinicianName," ",{layout:"noBorders",table:{widths:[80,80],body:[[{text:"From: "+c.startDate.toString(),fontSize:9},{text:"To: "+c.endDate.toString(),fontSize:9}]]}},"  ",{table:{headerRows:1,widths:[120,80,100,50,50,80],body:Z}}]};A.createPdf(W).print()}),window.pdfMake.vfs=y.pdfMake.vfs}ngOnInit(){return(0,d.Z)(function*(){})()}loadConsultationReport(l,o){var i=this;return(0,d.Z)(function*(){let e={headers:(new h.WM).set("Authorization","Bearer "+i.auth.user.access_token)};if(void 0!==l&&void 0!==o)if(l>o)i.msgBox.showErrorMessage3("Could not run. Start date must be earlier or equal to end date");else{null===i.clinicianId&&i.msgBox.showErrorMessage3("Could not run. Please select Doctor");var p={from:l,to:o,clinician:{id:i.clinicianId}};i.spinner.show(),yield i.http.post(C+"/reports/consultation_report",p,e).pipe((0,M.x)(()=>i.spinner.hide())).toPromise().then(f=>{i.consultations=f,console.log(i.consultations)}).catch(f=>{i.msgBox.showErrorMessage(f,"")})}else i.msgBox.showErrorMessage3("Could not run. Please select date range")})()}clear(){this.consultations=[],this.clinicianId=null,this.clinicianName="",this.clinicianCode="",this.clinicians=[],this.clinicianLocked=!1}loadCliniciansLike(l){var o=this;return(0,d.Z)(function*(){if(o.clinicians=[],l.length<2)return;let i={headers:(new h.WM).set("Authorization","Bearer "+o.auth.user.access_token)};yield o.http.get(C+"/clinicians/load_clinicians_like?name_like="+l,i).toPromise().then(e=>{console.log(e),o.clinicians=e}).catch(e=>{o.msgBox.showErrorMessage(e,"")})})()}getClinician(l){var o=this;return(0,d.Z)(function*(){let i={headers:(new h.WM).set("Authorization","Bearer "+o.auth.user.access_token)};o.clinicians=[],o.spinner.show(),yield o.http.get(C+"/clinicians/get?id="+l,i).pipe((0,M.x)(()=>o.spinner.hide())).toPromise().then(e=>{o.clinicianId=e?.id,o.clinicianCode=e.code,o.clinicianName=e.firstName+" "+e.middleName+" "+e.lastName,o.clinicianLocked=!0}).catch(e=>{o.msgBox.showErrorMessage(e,""),console.log(e)})})()}exportToSpreadsheet(){var l=this;return(0,d.Z)(function*(){let o=new E.Workbook,i=o.addWorksheet("Consultation Report");i.columns=[{header:"Patient Name",key:"PATIENT_NAME"},{header:"Patient Phone",key:"PATIENT_PHONE"},{header:"Registration#",key:"REGISTRATION_NO"},{header:"Payment Mode",key:"PAYMENT_MODE"},{header:"Consultation Date",key:"CONSULTATION_DATE"},{header:"Status",key:"STATUS"}],l.spinner.show(),l.consultations.forEach(e=>{i.addRow({PATIENT_NAME:(e?.patient?.firstName+" "+e.patient?.middleName+" "+e.patient?.lastName).toString(),PATIENT_PHONE:e?.patient?.phoneNo,REGISTRATION_NO:e?.patient?.no,PAYMENT_MODE:e?.insurancePlan?.name,CONSULTATION_DATE:(new g.c).transform(e?.createdAt),STATUS:e?.status},"n")}),l.spinner.hide(),o.xlsx.writeBuffer().then(e=>{let p=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});L.saveAs(p,"Consultations Report "+l.startDate.toString()+" to "+l.endDate.toString()+".xlsx")})})()}grant(l){var o=!1;return l.forEach(i=>{this.auth.checkPrivilege(i)&&(o=!0)}),o}}return(a=r).\u0275fac=function(l){return new(l||a)(t.Y36(x.e),t.Y36(h.eN),t.Y36(N.FF),t.Y36(D.t2),t.Y36(O.l),t.Y36(R.D))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-consultation-report"]],standalone:!0,features:[t.jDz],decls:47,vars:5,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["type","button",1,"btn","btn-success","btn-outline",3,"click"],[1,"fa","fa-print"],[1,"panel-body"],[1,"col-sm-3"],[1,"input-group"],["type","text","name","q","placeholder","Search Doctor...",1,"form-control",3,"ngModel","readonly","ngModelChange"],[1,"input-group-btn"],[1,"btn",3,"click"],[1,"fa","fa-times-rectangle"],["class","row",4,"ngIf"],[1,"col-sm-12",2,"height","100%","overflow","scroll"],[1,"table","table-responsive","table-hover","table-striped","table-small"],[2,"font-weight","bold"],[4,"ngFor","ngForOf"],["multiple","multiple",1,"form-control"],["style","height: 1cm; cursor: pointer; font-size: large;",3,"click",4,"ngFor","ngForOf"],[2,"height","1cm","cursor","pointer","font-size","large",3,"click"],[1,"col-sm-1"],[1,"col-sm-2"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","btn-outline",3,"click"],[4,"ngIf"]],template:function(l,o){1&l&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Consultations Report"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t.NdJ("click",function(){return o.print()}),t._UZ(10,"i",8),t._uU(11," Print"),t.qZA()(),t.TgZ(12,"div",9)(13,"div",3)(14,"div",4)(15,"div",3)(16,"div",10)(17,"h4"),t._uU(18,"Doctor Name"),t.qZA(),t.TgZ(19,"div",11)(20,"input",12),t.NdJ("ngModelChange",function(e){return o.clinicianName=e})("ngModelChange",function(e){return o.loadCliniciansLike(e)}),t.qZA(),t.TgZ(21,"span",13)(22,"button",14),t.NdJ("click",function(){return o.clear()}),t._UZ(23,"i",15),t.qZA()()(),t.YNc(24,I,4,1,"div",16),t.qZA()(),t._UZ(25,"hr"),t.YNc(26,S,17,2,"div",16),t.qZA()(),t.TgZ(27,"div",3)(28,"div",17),t._UZ(29,"hr"),t.TgZ(30,"table",18)(31,"thead")(32,"tr",19)(33,"td"),t._uU(34,"Patient Name"),t.qZA(),t.TgZ(35,"td"),t._uU(36,"Patient Phone"),t.qZA(),t.TgZ(37,"td"),t._uU(38,"Registration#"),t.qZA(),t.TgZ(39,"td"),t._uU(40,"Payment Mode"),t.qZA(),t.TgZ(41,"td"),t._uU(42,"Consultation Date"),t.qZA(),t.TgZ(43,"td"),t._uU(44,"Status"),t.qZA()()(),t.TgZ(45,"tbody"),t.YNc(46,k,15,11,"tr",20),t.qZA()()()()()()()()()),2&l&&(t.xp6(20),t.Q6J("ngModel",o.clinicianName)("readonly",o.clinicianLocked),t.xp6(4),t.Q6J("ngIf",o.clinicians.length>0),t.xp6(2),t.Q6J("ngIf",null!=o.clinicianId),t.xp6(20),t.Q6J("ngForOf",o.consultations))},dependencies:[m.ez,m.sg,m.O5,_.u5,_.YN,_.Kr,_.Fj,_.JJ,_.On,_.UX,g.c]}),r})()}}]);