"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[7996],{7996:(Y,P,a)=>{a.r(P),a.d(P,{PatientReportComponent:()=>q});var _=a(5861),u=a(6814),d=a(9862),c=a(95),v=a(4716),Z=a(977),M=a(553),y=a(7069),E=a(206),t=a(6689),A=a(6466),S=a(585),R=a(379),O=a(7857),D=a(2848);function B(r,f){if(1&r){const o=t.EpF();t.TgZ(0,"option",18),t.NdJ("click",function(){const s=t.CHM(o).$implicit,n=t.oxw(2);return t.KtG(n.getPatient(s.id))}),t.TgZ(1,"b"),t._uU(2),t.qZA(),t._uU(3," FileNo: "),t.TgZ(4,"b"),t._uU(5),t.qZA()()}if(2&r){const o=f.$implicit;t.xp6(2),t.lnq("",o.firstName," ",o.middleName," ",o.lastName," | "),t.xp6(3),t.Oqu(o.no)}}function U(r,f){if(1&r&&(t.TgZ(0,"div",3)(1,"div",4)(2,"select",16),t.YNc(3,B,6,4,"option",17),t.qZA()()()),2&r){const o=t.oxw();t.xp6(3),t.Q6J("ngForOf",o.patients)}}function K(r,f){1&r&&(t.TgZ(0,"span"),t._uU(1,"Covered"),t.qZA())}function b(r,f){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&r){const o=t.oxw().$implicit;t.xp6(1),t.Oqu(t.Dn7(2,1,null==o?null:o.amount,"",""))}}function z(r,f){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const o=t.oxw().$implicit;t.xp6(1),t.Oqu(null==o||null==o.insurancePlan?null:o.insurancePlan.name)}}function k(r,f){1&r&&(t.TgZ(0,"span"),t._uU(1,"Client"),t.qZA())}function I(r,f){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"dateTime"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td",25),t.YNc(9,K,2,0,"span",26),t.YNc(10,b,3,5,"span",26),t.qZA(),t.TgZ(11,"td"),t.YNc(12,z,2,1,"span",26),t.YNc(13,k,2,0,"span",26),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.qZA()()),2&r){const o=f.$implicit;t.xp6(2),t.Oqu(t.lcZ(3,8,o.createdAt)),t.xp6(3),t.Oqu(null==o?null:o.description),t.xp6(2),t.Oqu(null==o?null:o.qty),t.xp6(2),t.Q6J("ngIf","COVERED"===(null==o?null:o.status)),t.xp6(1),t.Q6J("ngIf","COVERED"!=(null==o?null:o.status)),t.xp6(2),t.Q6J("ngIf",null!=(null==o?null:o.insurancePlan)),t.xp6(1),t.Q6J("ngIf",null===(null==o?null:o.insurancePlan)),t.xp6(2),t.Oqu(null==o?null:o.status)}}function L(r,f){if(1&r){const o=t.EpF();t.TgZ(0,"div",3),t._UZ(1,"hr"),t.TgZ(2,"div",4)(3,"div",3)(4,"div",19)(5,"h4"),t._uU(6,"From"),t.qZA(),t.TgZ(7,"input",20),t.NdJ("ngModelChange",function(e){t.CHM(o);const s=t.oxw();return t.KtG(s.from=e)}),t.qZA()(),t.TgZ(8,"div",19)(9,"h4"),t._uU(10,"To"),t.qZA(),t.TgZ(11,"input",20),t.NdJ("ngModelChange",function(e){t.CHM(o);const s=t.oxw();return t.KtG(s.to=e)}),t.qZA()(),t.TgZ(12,"div",19),t._UZ(13,"br")(14,"br"),t.TgZ(15,"button",21),t.NdJ("click",function(){t.CHM(o);const e=t.oxw();return t.KtG(e.loadPatientBillsByDate(e.from,e.to))}),t._uU(16,"Run Report"),t.qZA()()()(),t.TgZ(17,"div",4)(18,"table",22)(19,"thead")(20,"tr",23)(21,"td"),t._uU(22,"Date"),t.qZA(),t.TgZ(23,"td"),t._uU(24,"Service/Item"),t.qZA(),t.TgZ(25,"td"),t._uU(26,"Qty"),t.qZA(),t.TgZ(27,"td"),t._uU(28,"Amount"),t.qZA(),t.TgZ(29,"td"),t._uU(30,"Billed to"),t.qZA(),t.TgZ(31,"td"),t._uU(32,"Bill Status"),t.qZA()()(),t.TgZ(33,"tbody"),t.YNc(34,I,16,10,"tr",24),t.qZA()()()()}if(2&r){const o=t.oxw();t.xp6(7),t.Q6J("ngModel",o.from),t.xp6(4),t.Q6J("ngModel",o.to),t.xp6(23),t.Q6J("ngForOf",o.patientBills)}}var F=a(6236);a(217);const m=M.N.apiUrl;let q=(()=>{var r;class f{constructor(i,e,s,n,g,l){var p=this;this.auth=i,this.http=e,this.spinner=s,this.msgBox=n,this.printer=g,this.data=l,this.searchKey="",this.id=null,this.no="",this.firstName="",this.middleName="",this.lastName="",this.patientType="",this.gender="",this.paymentType="",this.memberShipNo="",this.phoneNo="",this.address="",this.email="",this.nationality="",this.nationalId="",this.passportNo="",this.kinFullName="",this.kinRelationship="",this.kinPhoneNo="",this.patientRecordMode="",this.insurancePlan="",this.registrationFee=0,this.registrationFeeStatus="",this.cardValidationStatus="",this.registrationAmount=0,this.consultationAmount=0,this.total=0,this.amountReceived=0,this.lockSearchKey=!1,this.filterRecords="",this.patientBills=[],this.searchKeysToDisplay=[],this.searchKeys=[],this.patientId=null,this.patientNo="",this.patientFirstName="",this.patientMiddleName="",this.patientLastName="",this.patientPhoneNo="",this.patients=[],this.print=(0,_.Z)(function*(){if(0===p.patientBills.length)return void p.msgBox.showErrorMessage3("No data to export");p.documentHeader=yield p.data.getDocumentHeader();var C=0,N=[[{text:"SN",fontSize:9,fillColor:"#bdc6c7"},{text:"Date",fontSize:9,fillColor:"#bdc6c7"},{text:"Service/Item",fontSize:9,fillColor:"#bdc6c7"},{text:"Qty",fontSize:9,fillColor:"#bdc6c7"},{text:"Amount/Cov",fontSize:9,fillColor:"#bdc6c7"},{text:"Billed To",fontSize:9,fillColor:"#bdc6c7"},{text:"Status",fontSize:9,fillColor:"#bdc6c7"}]],T=1;C=0,p.patientBills.forEach(h=>{var x=[{text:T.toString(),fontSize:9,fillColor:"#ffffff"},{text:(new E.c).transform(h?.createdAt).toString(),fontSize:9,fillColor:"#ffffff"},{text:h?.description,fontSize:9,fillColor:"#ffffff"},{text:h?.qty.toString(),fontSize:9,fillColor:"#ffffff"},{text:p.getAmount(h),fontSize:9,alignment:"right",fillColor:"#ffffff"},{text:p.getBillTo(h),fontSize:9,fillColor:"#ffffff"},{text:h?.status,fontSize:9,fillColor:"#ffffff"}];T+=1,"COVERED"!=h.status&&(C+=h.amount),N.push(x)});var W=[{text:"",fontSize:9,fillColor:"#ffffff"},{text:"",fontSize:9,fillColor:"#ffffff"},{text:"Total",fontSize:9,fillColor:"#ffffff"},{text:"",fontSize:9,fillColor:"#ffffff"},{text:p.getTotal(C),fontSize:9,alignment:"right",bold:!0,fillColor:"#ffffff"},{text:"",fontSize:9,fillColor:"#ffffff"},{text:"",fontSize:9,fillColor:"#ffffff"}];N.push(W);const J={header:"",footer:function(h,x){return h.toString()+" of "+x},content:[{columns:[p.documentHeader]},"  ",{text:"Patient Report",fontSize:14,bold:!0,alignment:"center"},p.data.getHorizontalLine(),{text:"Name: "+p.firstName.toString()+" "+p.middleName?.toString()+" "+p.lastName?.toString(),fontSize:9},{text:"File No: "+p.no.toString(),fontSize:9},{text:"Date of Birth: "+(0,u.p6)(p.dateOfBirth,"yyyy-MM-dd","en-US"),fontSize:9},{text:"Mobile: "+p.phoneNo.toString(),fontSize:9}," ",{layout:"noBorders",table:{widths:[80,80],body:[[{text:"From: "+p.from.toString(),fontSize:9},{text:"To: "+p.to.toString(),fontSize:9}]]}},"  ",{table:{headerRows:1,widths:[20,50,130,20,70,100,50],body:N}}]};y.createPdf(J).print()}),window.pdfMake.vfs=F.pdfMake.vfs}ngOnInit(){}loadSearchKeys(){var i=this;return(0,_.Z)(function*(){let e={headers:(new d.WM).set("Authorization","Bearer "+i.auth.user.access_token)};i.spinner.show(),yield i.http.get(m+"/patients/get_all_search_keys",e).pipe((0,v.x)(()=>i.spinner.hide())).toPromise().then(s=>{console.log(s),i.searchKeys=[],s?.forEach(n=>{i.searchKeys.push(n)})},s=>{console.log(s),i.msgBox.showErrorMessage(s,"Could not load patients")})})()}filterSearchKeys(i){this.searchKeysToDisplay=[],!(i.length<4)&&this.searchKeys.forEach(e=>{var s=e.toLowerCase(),n=i.toLowerCase();s.includes(n)&&this.searchKeysToDisplay.push(e)})}searchBySearchKey(i){var e=this;return(0,_.Z)(function*(){var s="";e.registrationAmount=0,e.consultationAmount=0;for(var n=0;n<e.searchKeys.length;n++)if(e.searchKeys[n]===i){s=i;break}if(0===s.length)return;let g={headers:(new d.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.get(m+"/patients/get_by_search_key?search_key="+s,g).pipe((0,v.x)(()=>e.spinner.hide())).toPromise().then(l=>{e.searchKey=i,e.id=l.id,e.no=l.no,e.firstName=l.firstName,e.middleName=l.middleName,e.lastName=l.lastName,e.dateOfBirth=l.dateOfBirth,e.phoneNo=l.phoneNo,e.address=l.address,e.lockSearchKey=!0,e.total=0}).catch(l=>{console.log(l),e.clear(),e.msgBox.showErrorMessage(l,"Could not find patient")})})()}clear(){this.id=null,this.no="",this.firstName="",this.middleName="",this.lastName="",this.gender="",this.paymentType="",this.memberShipNo="",this.phoneNo="",this.address="",this.email="",this.nationality="",this.nationalId="",this.passportNo="",this.kinFullName="",this.kinRelationship="",this.kinPhoneNo="",this.amountReceived=0,this.total=0,this.lockSearchKey=!1,this.patients=[]}reset(){this.searchKey="",this.clear(),this.patientBills=[]}grant(i){var e=!1;return i.forEach(s=>{this.auth.checkPrivilege(s)&&(e=!0)}),e}loadPatientsLike(i){var e=this;return(0,_.Z)(function*(){if(e.patients=[],i.length<3)return;let s={headers:(new d.WM).set("Authorization","Bearer "+e.auth.user.access_token)};yield e.http.get(m+"/patients/load_patients_like?name_like="+i,s).toPromise().then(n=>{console.log(n),e.patients=n}).catch(n=>{e.msgBox.showErrorMessage(n,"")})})()}getPatient(i){var e=this;return(0,_.Z)(function*(){let s={headers:(new d.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.patients=[],e.spinner.show(),yield e.http.get(m+"/patients/get?id="+i,s).pipe((0,v.x)(()=>e.spinner.hide())).toPromise().then(n=>{e.patientId=n?.id,e.patientNo=n.no,e.patientFirstName=n.firstName,e.patientMiddleName=n.middleName,e.patientLastName=n.lastName,e.patientPhoneNo=n.phoneNo,e.searchKey="Name: "+e.patientFirstName+" "+e.patientMiddleName+" "+e.patientLastName+" File No: "+e.patientNo,e.id=n.id,e.no=n.no,e.firstName=n.firstName,e.middleName=n.middleName,e.lastName=n.lastName,e.gender=n.gender,e.dateOfBirth=n.dateOfBirth,e.paymentType=n.paymentType,e.phoneNo=n.phoneNo,e.address=n.address,e.email=n.email,e.nationality=n.nationality,e.nationalId=n.nationalId,e.passportNo=n.passportNo,e.kinFullName=n.kinFullName,e.kinRelationship=n.kinRelationship,e.kinPhoneNo=n.kinPhoneNo,e.lockSearchKey=!0,e.total=0}).catch(n=>{e.clear(),e.msgBox.showErrorMessage(n,""),console.log(n)})})()}loadPatientBillsByDate(i,e){var s=this;return(0,_.Z)(function*(){let n={headers:(new d.WM).set("Authorization","Bearer "+s.auth.user.access_token)};if(void 0!==i&&void 0!==e)if(i>e)s.msgBox.showErrorMessage3("Could not run. Start date must be earlier or equal to end date");else{var g={patient:{id:s.id},from:i,to:e};s.spinner.show(),yield s.http.post(m+"/reports/get_patient_bills_by_date",g,n).pipe((0,v.x)(()=>s.spinner.hide())).toPromise().then(l=>{console.log(l),s.patientBills=l}).catch(l=>{console.log(l),s.msgBox.showErrorMessage(l,"")})}else s.msgBox.showErrorMessage3("Could not run. Please select date range")})()}getAmount(i){return"COVERED"===i.status?"Covered":i.amount.toLocaleString("en-US",{minimumFractionDigits:2})}getBillTo(i){return"COVERED"===i.status?i?.insurancePlan?.name:"Client"}getTotal(i){return 0===i?"Covered":i.toLocaleString("en-US",{minimumFractionDigits:2})}}return(r=f).\u0275fac=function(i){return new(i||r)(t.Y36(A.e),t.Y36(d.eN),t.Y36(S.t2),t.Y36(R.l),t.Y36(O.r),t.Y36(D.D))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-patient-report"]],standalone:!0,features:[t.jDz],decls:30,vars:4,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["type","button",1,"btn","btn-success","btn-outline",3,"click"],[1,"fa","fa-print"],[1,"panel-body"],[1,"col-xs-8"],[1,"text-primary"],["type","text","placeholder","Search...",1,"form-control",2,"max-width","15cm",3,"ngModel","readonly","ngModelChange"],["class","row",4,"ngIf"],[1,"col-xs-4"],[1,"btn","btn-deafult","btn-outline",3,"click"],["multiple","multiple",1,"form-control",2,"max-width","15cm"],["style","height: 1cm; cursor: pointer; font-size: large;",3,"click",4,"ngFor","ngForOf"],[2,"height","1cm","cursor","pointer","font-size","large",3,"click"],[1,"col-sm-3"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary",3,"click"],[1,"table","table-responsive","table-striped","table-small"],[2,"font-weight","bold"],[4,"ngFor","ngForOf"],[2,"text-align","right"],[4,"ngIf"]],template:function(i,e){1&i&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Patient Report"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t.NdJ("click",function(){return e.print()}),t._UZ(10,"i",8),t._uU(11," Print"),t.qZA()(),t.TgZ(12,"div",9)(13,"div",3)(14,"div",4)(15,"div",3)(16,"div",4)(17,"div",3)(18,"div",10)(19,"h4",11)(20,"b"),t._uU(21,"Search Patient(Enter 3 characters)Name, File No or Phone"),t.qZA()(),t.TgZ(22,"input",12),t.NdJ("ngModelChange",function(n){return e.searchKey=n})("ngModelChange",function(n){return e.loadPatientsLike(n)}),t.qZA(),t.YNc(23,U,4,1,"div",13),t.qZA(),t.TgZ(24,"div",14),t._UZ(25,"br")(26,"br"),t.TgZ(27,"button",15),t.NdJ("click",function(){return e.reset()}),t._uU(28,"Reset"),t.qZA()()()()()()(),t.YNc(29,L,35,3,"div",13),t.qZA()()()()()),2&i&&(t.xp6(22),t.Q6J("ngModel",e.searchKey)("readonly",e.lockSearchKey),t.xp6(1),t.Q6J("ngIf",!1===e.lockSearchKey&&e.patients.length>0),t.xp6(6),t.Q6J("ngIf",null!=e.id))},dependencies:[u.ez,u.sg,u.O5,u.H9,c.u5,c.YN,c.Kr,c.Fj,c.JJ,c.On,c.UX,Z.$]}),f})()}}]);