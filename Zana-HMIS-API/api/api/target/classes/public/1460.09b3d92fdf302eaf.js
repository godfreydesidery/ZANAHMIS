"use strict";(self.webpackChunkzana_hmis=self.webpackChunkzana_hmis||[]).push([[1460],{1460:(I,Z,a)=>{a.r(Z),a.d(Z,{ProcedurePaymentComponent:()=>D});var u=a(5861),h=a(6814),d=a(9862),p=a(95),y=a(8237),_=a(4716),f=a(5614),v=a(553),t=a(6689),P=a(6466),T=a(585),b=a(379),A=a(7857);function N(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"option",37),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw(2);return t.KtG(i.getPatient(o.id))}),t.TgZ(1,"b"),t._uU(2),t.qZA(),t._uU(3," FileNo: "),t.TgZ(4,"b"),t._uU(5),t.qZA()()}if(2&s){const r=l.$implicit;t.xp6(2),t.lnq("",r.firstName," ",r.middleName," ",r.lastName," | "),t.xp6(3),t.Oqu(r.no)}}function U(s,l){if(1&s&&(t.TgZ(0,"div",3)(1,"div",4)(2,"select",35),t.YNc(3,N,6,4,"option",36),t.qZA()()()),2&s){const r=t.oxw();t.xp6(3),t.Q6J("ngForOf",r.patients)}}function x(s,l){if(1&s&&(t.TgZ(0,"div",29),t._UZ(1,"br"),t.TgZ(2,"div",38)(3,"div",12)(4,"div",39)(5,"h3",15)(6,"b"),t._uU(7,"Patient Inf"),t.qZA()(),t.TgZ(8,"table",40)(9,"tbody")(10,"tr")(11,"td")(12,"b"),t._uU(13,"Full Name"),t.qZA()(),t.TgZ(14,"td"),t._uU(15),t.qZA()(),t.TgZ(16,"tr")(17,"td")(18,"b"),t._uU(19,"Phone No"),t.qZA()(),t.TgZ(20,"td"),t._uU(21),t.qZA()(),t.TgZ(22,"tr")(23,"td")(24,"b"),t._uU(25,"Address"),t.qZA()(),t.TgZ(26,"td"),t._uU(27),t.qZA()(),t.TgZ(28,"tr")(29,"td")(30,"b"),t._uU(31,"File No"),t.qZA()(),t.TgZ(32,"td"),t._uU(33),t.qZA()(),t.TgZ(34,"tr")(35,"td")(36,"b"),t._uU(37,"Date of Birth"),t.qZA()(),t.TgZ(38,"td"),t._uU(39),t.ALo(40,"date"),t.qZA()()()()()()()()),2&s){const r=t.oxw();t.xp6(15),t.Oqu(r.firstName+" "+r.middleName+" "+r.lastName),t.xp6(6),t.Oqu(r.phoneNo),t.xp6(6),t.Oqu(r.address),t.xp6(6),t.Oqu(r.no),t.xp6(6),t.Oqu(t.lcZ(40,5,r.dateOfBirth))}}function q(s,l){if(1&s&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",45),t._uU(8),t.ALo(9,"currency"),t.qZA()()),2&s){const r=t.oxw(3);t.xp6(2),t.Oqu(r.registrationBill.id),t.xp6(2),t.Oqu(r.registrationBill.description),t.xp6(2),t.Oqu(r.registrationBill.qty),t.xp6(2),t.Oqu(t.Dn7(9,4,r.registrationBill.amount,"",""))}}function B(s,l){if(1&s&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",45),t._uU(8),t.ALo(9,"currency"),t.qZA()()),2&s){const r=l.$implicit;t.xp6(2),t.Oqu(r.id),t.xp6(2),t.Oqu(r.description),t.xp6(2),t.Oqu(r.qty),t.xp6(2),t.Oqu(t.Dn7(9,4,r.amount,"",""))}}function C(s,l){if(1&s&&(t.TgZ(0,"tr"),t._UZ(1,"td")(2,"td"),t.TgZ(3,"td")(4,"b"),t._uU(5,"Total"),t.qZA()(),t.TgZ(6,"td",45)(7,"b"),t._uU(8),t.ALo(9,"currency"),t.qZA()()()),2&s){const r=t.oxw(3);t.xp6(8),t.Oqu(t.Dn7(9,1,r.total,"",""))}}function M(s,l){if(1&s&&(t.TgZ(0,"div")(1,"span"),t._uU(2,"Bills"),t.qZA(),t.TgZ(3,"table",43)(4,"thead")(5,"tr")(6,"td"),t._uU(7,"ID"),t.qZA(),t.TgZ(8,"td"),t._uU(9,"Description"),t.qZA(),t.TgZ(10,"td"),t._uU(11,"Qty"),t.qZA(),t.TgZ(12,"td"),t._uU(13,"Amount"),t.qZA()()(),t.TgZ(14,"tbody"),t.YNc(15,q,10,8,"tr",41),t.YNc(16,B,10,8,"tr",44),t.YNc(17,C,10,5,"tr",41),t.qZA()()()),2&s){const r=t.oxw(2);t.xp6(15),t.Q6J("ngIf",null!=r.registrationBill),t.xp6(1),t.Q6J("ngForOf",r.procedureBills),t.xp6(1),t.Q6J("ngIf",r.total>0)}}function E(s,l){1&s&&(t.TgZ(0,"div")(1,"div",3)(2,"div",46)(3,"span"),t._uU(4,"Select Method"),t.qZA(),t.TgZ(5,"select",47)(6,"option"),t._uU(7,"CASH"),t.qZA(),t.TgZ(8,"option"),t._uU(9,"M-PESA"),t.qZA()()(),t.TgZ(10,"div",48),t._UZ(11,"br"),t.TgZ(12,"button",49),t._uU(13,"Confirm"),t.qZA()(),t.TgZ(14,"div",48),t._UZ(15,"br"),t.TgZ(16,"button",50),t._uU(17,"Cancel"),t.qZA()()()())}function O(s,l){1&s&&(t.TgZ(0,"div",51),t._uU(1," No Bill Present "),t.qZA())}function K(s,l){if(1&s&&(t.TgZ(0,"div",29),t._UZ(1,"br"),t.YNc(2,M,18,3,"div",41),t.YNc(3,E,18,0,"div",41),t.YNc(4,O,2,0,"div",42),t.qZA()),2&s){const r=t.oxw();t.xp6(2),t.Q6J("ngIf",r.procedureBills.length>0||null!=r.registrationBill),t.xp6(1),t.Q6J("ngIf",r.total>0),t.xp6(1),t.Q6J("ngIf",0===r.procedureBills.length&&null===r.registrationBill)}}function k(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"button",52),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.printReceipt())})("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.confirmBillsPayment())}),t._uU(1,"Confirm"),t.qZA()}}const m=v.N.apiUrl;let D=(()=>{var s;class l{constructor(n,e,o,i,g){this.auth=n,this.http=e,this.spinner=o,this.msgBox=i,this.printer=g,this.searchKey="",this.id=null,this.no="",this.firstName="",this.middleName="",this.lastName="",this.type="",this.gender="",this.paymentType="",this.memberShipNo="",this.phoneNo="",this.address="",this.email="",this.nationality="",this.nationalId="",this.passportNo="",this.kinFullName="",this.kinRelationship="",this.kinPhoneNo="",this.patientRecordMode="",this.insurancePlan="",this.registrationFee=0,this.registrationFeeStatus="",this.cardValidationStatus="",this.procedureBills=[],this.registrationAmount=0,this.total=0,this.amountReceived=0,this.lockSearchKey=!1,this.filterRecords="",this.searchKeysToDisplay=[],this.searchKeys=[],this.patientId=null,this.patientNo="",this.patientFirstName="",this.patientMiddleName="",this.patientLastName="",this.patientPhoneNo="",this.patients=[]}ngOnInit(){}loadSearchKeys(){var n=this;return(0,u.Z)(function*(){let e={headers:(new d.WM).set("Authorization","Bearer "+n.auth.user.access_token)};n.spinner.show(),yield n.http.get(m+"/patients/get_all_search_keys",e).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(o=>{console.log(o),n.searchKeys=[],o?.forEach(i=>{n.searchKeys.push(i)})},o=>{console.log(o),n.msgBox.showErrorMessage(o,"Could not load patients")})})()}filterSearchKeys(n){this.searchKeysToDisplay=[],!(n.length<4)&&this.searchKeys.forEach(e=>{var o=e.toLowerCase(),i=n.toLowerCase();o.includes(i)&&this.searchKeysToDisplay.push(e)})}searchBySearchKey(n){var e=this;return(0,u.Z)(function*(){var o="";e.registrationAmount=0;for(var i=0;i<e.searchKeys.length;i++)if(e.searchKeys[i]===n){o=n;break}if(0===o.length)return;let g={headers:(new d.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.spinner.show(),yield e.http.get(m+"/patients/get_by_search_key?search_key="+o,g).pipe((0,_.x)(()=>e.spinner.hide())).toPromise().then(c=>{e.searchKey=n,e.id=c.id,e.no=c.no,e.firstName=c.firstName,e.middleName=c.middleName,e.lastName=c.lastName,e.dateOfBirth=c.dateOfBirth,e.phoneNo=c.phoneNo,e.address=c.address,e.lockSearchKey=!0,e.total=0,e.loadRegistrationBill(),e.loadProcedureBills()}).catch(c=>{console.log(c),e.clear(),e.msgBox.showErrorMessage(c,"Could not find patient")})})()}clear(){this.id=null,this.no="",this.firstName="",this.middleName="",this.lastName="",this.gender="",this.paymentType="",this.memberShipNo="",this.phoneNo="",this.address="",this.email="",this.nationality="",this.nationalId="",this.passportNo="",this.kinFullName="",this.kinRelationship="",this.kinPhoneNo="",this.amountReceived=0,this.total=0,this.lockSearchKey=!1,this.patients=[]}reset(){this.searchKey="",this.clear()}loadRegistrationBill(){var n=this;return(0,u.Z)(function*(){let e={headers:(new d.WM).set("Authorization","Bearer "+n.auth.user.access_token)};n.spinner.show(),yield n.http.get(m+"/bills/get_registration_bill?patient_id="+n.id,e).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(o=>{console.log(o),n.registrationBill=o,null!=n.registrationBill&&(n.registrationAmount=n.registrationBill.amount),n.total=n.total+n.registrationAmount}).catch(o=>{console.log(o),n.msgBox.showErrorMessage(o,"Could not load registration bill")})})()}loadProcedureBills(){var n=this;return(0,u.Z)(function*(){n.procedureBills=[];let e={headers:(new d.WM).set("Authorization","Bearer "+n.auth.user.access_token)};n.spinner.show(),yield n.http.get(m+"/bills/get_procedure_bills?patient_id="+n.id,e).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(o=>{console.log(o),n.procedureBills=o,n.procedureBills.forEach(i=>{n.total=n.total+i.amount})}).catch(o=>{console.log(o),n.msgBox.showErrorMessage(o,"Could not load procedure bill")})})()}confirmBillsPayment(){var n=this;return(0,u.Z)(function*(){let e={headers:(new d.WM).set("Authorization","Bearer "+n.auth.user.access_token)};var o=[];n.registrationBill&&o.push(n.registrationBill),n.procedureBills.forEach(i=>{o.push(i)}),console.log(o),n.spinner.show(),yield n.http.post(m+"/bills/confirm_bills_payment?total_amount="+n.total,o,e).pipe((0,_.x)(()=>n.spinner.hide())).toPromise().then(i=>{console.log(i),n.msgBox.showSuccessMessage("Payment successiful");var g=n.searchKey;n.clear(),n.searchKey=g,n.searchBySearchKey(n.searchKey)}).catch(i=>{console.log(i),n.msgBox.showErrorMessage(i,"Could not confirm payment")})})()}printReceipt(){var e,n=[];this.procedureBills.forEach(o=>{(e=new f.$).code=o.id,e.name=o.description,e.amount=o.amount,e.qty=o.qty,n.push(e)}),this.printer.print(n,"NA",0,this.patient)}grant(n){var e=!1;return n.forEach(o=>{this.auth.checkPrivilege(o)&&(e=!0)}),e}loadPatientsLike(n){var e=this;return(0,u.Z)(function*(){if(e.patients=[],n.length<3)return;let o={headers:(new d.WM).set("Authorization","Bearer "+e.auth.user.access_token)};yield e.http.get(m+"/patients/load_patients_like?name_like="+n,o).toPromise().then(i=>{console.log(i),e.patients=i}).catch(i=>{e.msgBox.showErrorMessage(i,"")})})()}getPatient(n){var e=this;return(0,u.Z)(function*(){let o={headers:(new d.WM).set("Authorization","Bearer "+e.auth.user.access_token)};e.patients=[],e.spinner.show(),yield e.http.get(m+"/patients/get?id="+n,o).pipe((0,_.x)(()=>e.spinner.hide())).toPromise().then(i=>{e.patient=i,e.patientId=i?.id,e.patientNo=i.no,e.patientFirstName=i.firstName,e.patientMiddleName=i.middleName,e.patientLastName=i.lastName,e.patientPhoneNo=i.phoneNo,e.searchKey="Name: "+e.patientFirstName+" "+e.patientMiddleName+" "+e.patientLastName+" File No: "+e.patientNo,e.id=i.id,e.no=i.no,e.firstName=i.firstName,e.middleName=i.middleName,e.lastName=i.lastName,e.gender=i.gender,e.dateOfBirth=i.dateOfBirth,e.paymentType=i.paymentType,e.phoneNo=i.phoneNo,e.address=i.address,e.email=i.email,e.nationality=i.nationality,e.nationalId=i.nationalId,e.passportNo=i.passportNo,e.kinFullName=i.kinFullName,e.kinRelationship=i.kinRelationship,e.kinPhoneNo=i.kinPhoneNo,e.lockSearchKey=!0,e.total=0,e.loadRegistrationBill(),e.loadProcedureBills()}).catch(i=>{e.clear(),e.msgBox.showErrorMessage(i,""),console.log(i)})})()}}return(s=l).\u0275fac=function(n){return new(n||s)(t.Y36(P.e),t.Y36(d.eN),t.Y36(T.t2),t.Y36(b.l),t.Y36(A.r))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-procedure-payment"]],standalone:!0,features:[t.jDz],decls:86,vars:17,consts:[[1,"content-header"],[1,"header-title"],[1,"content"],[1,"row"],[1,"col-sm-12"],[1,"panel","panel-bd","lobidrag"],[1,"panel-heading"],["routerLink","/registration-payment",1,"btn","btn-primary","btn-outline",2,"margin","1mm"],["routerLink","/lab-test-payment",1,"btn","btn-primary","btn-outline",2,"margin","1mm"],["routerLink","/radiology-payment",1,"btn","btn-primary","btn-outline",2,"margin","1mm"],["routerLink","/medication-payment",1,"btn","btn-primary","btn-outline",2,"margin","1mm"],["routerLink","/procedure-payment",1,"btn","btn-primary",2,"margin","1mm"],[1,"panel-body"],[1,"col-xs-3"],[1,"col-xs-6"],[1,"text-primary"],["type","text","placeholder","Search...",1,"form-control",2,"max-width","15cm",3,"ngModel","readonly","ngModelChange"],["class","row",4,"ngIf"],[1,"btn","btn-deafult","btn-outline",3,"click"],["class","col-sm-6",4,"ngIf"],["id","confirm-payment-modal","tabindex","-1","role","dialog",1,"modal","fade","modal-success"],["role","document",1,"modal-dialog","modal-sm"],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-title"],[1,"modal-body"],[1,"col-sm-6",2,"text-align","right"],[1,"col-sm-6"],[1,"form-control",2,"text-align","right"],["type","text",1,"form-control",2,"text-align","center",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-danger"],["type","button","class","btn btn-success","data-dismiss","modal",3,"click",4,"ngIf"],["multiple","multiple",1,"form-control",2,"max-width","15cm"],["style","height: 1cm; cursor: pointer; font-size: large;",3,"click",4,"ngFor","ngForOf"],[2,"height","1cm","cursor","pointer","font-size","large",3,"click"],[1,"col-sm-12","jumbotron",2,"border-radius","2mm"],[1,"table-responsive"],[1,"table","table-bordered","table-small","table-striped"],[4,"ngIf"],["class","alert alert-success","role","alert","style","text-align: center;",4,"ngIf"],[1,"table","table-bordered","table-small"],[4,"ngFor","ngForOf"],[2,"text-align","right"],[1,"col-xs-4"],[1,"form-control"],[1,"col-xs-4",2,"text-align","center"],["data-toggle","modal","data-target","#confirm-payment-modal",1,"btn","btn-success"],[1,"btn","btn-danger"],["role","alert",1,"alert","alert-success",2,"text-align","center"],["type","button","data-dismiss","modal",1,"btn","btn-success",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"section",0)(1,"div",1)(2,"h1"),t._uU(3,"Procedure Payment"),t.qZA()()(),t.TgZ(4,"section",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),t._uU(10,"Registration"),t.qZA(),t.TgZ(11,"button",8),t._uU(12,"Lab Investigation"),t.qZA(),t.TgZ(13,"button",9),t._uU(14,"Radiology"),t.qZA(),t.TgZ(15,"button",10),t._uU(16,"Medication"),t.qZA(),t.TgZ(17,"button",11),t._uU(18,"Procedure"),t.qZA()(),t.TgZ(19,"div",12)(20,"div")(21,"div",3)(22,"div",4)(23,"div",3)(24,"div",4)(25,"div",3),t._UZ(26,"div",13),t.TgZ(27,"div",14)(28,"h4",15)(29,"b"),t._uU(30,"Search Patient(Enter 3 characters)"),t._UZ(31,"br"),t._uU(32," Name, File No or Phone"),t.qZA()(),t.TgZ(33,"input",16),t.NdJ("ngModelChange",function(i){return e.searchKey=i})("ngModelChange",function(i){return e.loadPatientsLike(i)}),t.qZA(),t.YNc(34,U,4,1,"div",17),t.qZA(),t.TgZ(35,"div",13),t._UZ(36,"br")(37,"br")(38,"br"),t.TgZ(39,"button",18),t.NdJ("click",function(){return e.reset()}),t._uU(40,"Reset"),t.qZA()()()()()(),t._UZ(41,"br"),t.qZA(),t.TgZ(42,"div",3),t.YNc(43,x,41,7,"div",19),t.YNc(44,K,5,3,"div",19),t.qZA(),t._UZ(45,"br"),t.qZA()()()()()(),t.TgZ(46,"div",20)(47,"div",21)(48,"div",22)(49,"div",23)(50,"button",24)(51,"span",25),t._uU(52,"\xd7"),t.qZA()(),t.TgZ(53,"h2",26),t._uU(54,"Confirm Payment"),t.qZA()(),t.TgZ(55,"div",27)(56,"div",3)(57,"div",28)(58,"span"),t._uU(59,"Total Amount"),t.qZA()(),t.TgZ(60,"div",29)(61,"span",30)(62,"b"),t._uU(63),t.ALo(64,"currency"),t.qZA()()()(),t._UZ(65,"br"),t.TgZ(66,"div",3)(67,"div",28)(68,"span"),t._uU(69,"Amount Received"),t.qZA()(),t.TgZ(70,"div",29)(71,"input",31),t.NdJ("ngModelChange",function(i){return e.amountReceived=i}),t.qZA()()(),t._UZ(72,"hr"),t.TgZ(73,"div",3)(74,"div",28)(75,"span"),t._uU(76,"Change"),t.qZA()(),t.TgZ(77,"div",29)(78,"span",30)(79,"b"),t._uU(80),t.ALo(81,"currency"),t.qZA()()()()(),t.TgZ(82,"div",32)(83,"button",33),t._uU(84,"Close"),t.qZA(),t.YNc(85,k,2,0,"button",34),t.qZA()()()()),2&n&&(t.xp6(33),t.Q6J("ngModel",e.searchKey)("readonly",e.lockSearchKey),t.xp6(1),t.Q6J("ngIf",!1===e.lockSearchKey&&e.patients.length>0),t.xp6(9),t.Q6J("ngIf",null!=e.id),t.xp6(1),t.Q6J("ngIf",null!=e.id),t.xp6(19),t.Oqu(t.Dn7(64,9,e.total,"","")),t.xp6(8),t.Q6J("ngModel",e.amountReceived),t.xp6(9),t.Oqu(t.Dn7(81,13,e.amountReceived-e.total,"","")),t.xp6(5),t.Q6J("ngIf",e.amountReceived-e.total>=0))},dependencies:[h.ez,h.sg,h.O5,h.H9,h.uU,p.u5,p.YN,p.Kr,p.Fj,p.JJ,p.On,p.UX,y.rH],styles:["option[_ngcontent-%COMP%]:hover{background-color:#483d8b;color:#fff}"]}),l})()}}]);